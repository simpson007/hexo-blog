{"meta":{"version":1,"warehouse":"4.0.1"},"models":{"Asset":[{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/algolia.svg","path":"img/algolia.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/loading.gif","path":"img/loading.gif","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":0},{"_id":"source/img/avatar.jpg","path":"img/avatar.jpg","modified":0,"renderable":0},{"_id":"source/img/bg-1.jpg","path":"img/bg-1.jpg","modified":0,"renderable":0},{"_id":"source/img/bg-2.jpg","path":"img/bg-2.jpg","modified":0,"renderable":0},{"_id":"source/img/bg.jpg","path":"img/bg.jpg","modified":0,"renderable":0},{"_id":"source/img/dbg-1.jpg","path":"img/dbg-1.jpg","modified":0,"renderable":0},{"_id":"source/img/dbg-2.jpg","path":"img/dbg-2.jpg","modified":0,"renderable":0},{"_id":"source/img/dbg-3.jpg","path":"img/dbg-3.jpg","modified":0,"renderable":0},{"_id":"source/img/link.jpg","path":"img/link.jpg","modified":0,"renderable":0},{"_id":"source/img/me.jpg","path":"img/me.jpg","modified":0,"renderable":0},{"_id":"source/img/tutorials/tutorials-bg.png","path":"img/tutorials/tutorials-bg.png","modified":0,"renderable":0},{"_id":"source/img/tutorials/tutorials-cover.png","path":"img/tutorials/tutorials-cover.png","modified":0,"renderable":0},{"_id":"source/img/scratch_custom/img-1.png","path":"img/scratch_custom/img-1.png","modified":0,"renderable":0},{"_id":"source/img/scratch_custom/img-2.png","path":"img/scratch_custom/img-2.png","modified":0,"renderable":0},{"_id":"source/img/scratch_custom/img-3.png","path":"img/scratch_custom/img-3.png","modified":0,"renderable":0},{"_id":"source/img/scratch_custom/img-4.png","path":"img/scratch_custom/img-4.png","modified":0,"renderable":0},{"_id":"source/img/scratch_custom/img-5.png","path":"img/scratch_custom/img-5.png","modified":0,"renderable":0},{"_id":"source/img/scratch_custom/img-6.png","path":"img/scratch_custom/img-6.png","modified":0,"renderable":0},{"_id":"source/img/scratch_custom/scratch-bg.png","path":"img/scratch_custom/scratch-bg.png","modified":0,"renderable":0},{"_id":"source/img/scratch_custom/scratch-cover.jpg","path":"img/scratch_custom/scratch-cover.jpg","modified":0,"renderable":0},{"_id":"source/img/fix_tales/fix-tales-bg.png","path":"img/fix_tales/fix-tales-bg.png","modified":0,"renderable":0},{"_id":"source/img/fix_tales/fix-tales-cover.png","path":"img/fix_tales/fix-tales-cover.png","modified":0,"renderable":0}],"Cache":[{"_id":"source/about/index.md","hash":"48a95929e3f787fd51d873e59c0029ef62bc952f","modified":1659106132119},{"_id":"source/CNAME","hash":"aaa04ffbbb597c9bd20bb21814af704ad6f1e89d","modified":1658938431237},{"_id":"source/_posts/fix_tales_1.md","hash":"88fa5106af46bca7a904f2fda9a722b0090c8c0f","modified":1725432919723},{"_id":"source/_posts/scratch_custom_1.md","hash":"6ad2a680e2b60d21f52af23c9efeb928f70d9f81","modified":1725430706434},{"_id":"source/_posts/scratch_custom_2.md","hash":"84626289875848204d3f3b59f84a01d3553700fd","modified":1725430560783},{"_id":"source/_posts/scratch_custom_3.md","hash":"1a57a45e5e32f019715665f008932f82d8e6c11a","modified":1725430568242},{"_id":"source/comments/index.md","hash":"7d6620924ec2d611bec34c2c79a0a07e208c868d","modified":1659103306949},{"_id":"source/gallery/index.md","hash":"d039890fb1ffedd8c1401495c920a498550bb3db","modified":1685344782537},{"_id":"source/gallery/wedding-main.md","hash":"15c968bc042e918aacb7ed5161520acf7beff977","modified":1688000307186},{"_id":"source/_posts/tutorials_1.md","hash":"15efad3a33363c77bce9303f43831220405ea98f","modified":1725440768842},{"_id":"source/gallery/wedding-other.md","hash":"0c5b48d76588a746bf735e3351d40a5d0a6654a5","modified":1685345176519},{"_id":"source/img/.DS_Store","hash":"34e41996320d64e4e4dff15a384ff913adcef7e6","modified":1725357454829},{"_id":"source/categories/index.md","hash":"e52615544f823fd51d3cf4f2813453711a641d94","modified":1659093521263},{"_id":"source/link/index.md","hash":"5336b95877d287fdda3abece785961efed5f05d9","modified":1659105486669},{"_id":"source/movies/index.md","hash":"17ca3200d87e931f93daaa4837143aec395f0027","modified":1659103476118},{"_id":"source/_data/link.yml","hash":"f8bf9a8e989134d13c2174ad8a923913f879a972","modified":1659106212576},{"_id":"source/tags/index.md","hash":"931184e29b0ba317ba9ed7d2859843166b229996","modified":1659093513052},{"_id":"source/music/index.md","hash":"62bc6f1aaade39405f2952ff2e77d9b3cb25eb71","modified":1659103462109},{"_id":"source/img/me.jpg","hash":"f62501f14480691dd4881f0304694cb71aacc366","modified":1659105417612},{"_id":"source/img/scratch_custom/img-1.png","hash":"8eb16527bbf2c06dcd5ce24b3a06d22b9cb4267d","modified":1725355755235},{"_id":"source/img/scratch_custom/img-3.png","hash":"cdf3d2f84414cecdc6bfe1ae87374d7fe7a6be7a","modified":1725430115721},{"_id":"source/img/scratch_custom/img-5.png","hash":"5a97804ef846b1a818a5e237fd9c06352a376ab1","modified":1725430534832},{"_id":"source/img/avatar.jpg","hash":"56032826b861af1ac0bcf220f2ebc029207e31f5","modified":1659105699205},{"_id":"source/img/dbg-2.jpg","hash":"4628394714666bd14205f5a00e1edc9cf563f530","modified":1658991862660},{"_id":"source/img/scratch_custom/img-2.png","hash":"41b349f336ac4c04431296558af2e8f246ac130c","modified":1725355755230},{"_id":"source/img/dbg-1.jpg","hash":"6d0f7d2d9c4b8362f7d2ec41b14d2e3aefd365ef","modified":1658991858574},{"_id":"source/img/dbg-3.jpg","hash":"8fe2a0a85c2c6ae022507c4d472ea66f868e565f","modified":1658991874768},{"_id":"source/img/scratch_custom/scratch-cover.jpg","hash":"a51161f8570e1e8d6bc0d00626656e7109724cf1","modified":1725357446912},{"_id":"node_modules/hexo-theme-butterfly/README.md","hash":"32ada08cfe64b38f8d5ac5de31cfb92956ff407c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/package.json","hash":"ab5358cd0c24dced2c99c292051831c39912c776","modified":1658938592498},{"_id":"node_modules/hexo-theme-butterfly/README_CN.md","hash":"dc38de6a558b66e05188fc62c5047ec982a74ff3","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/_config.yml","hash":"f94af3be4a1fdd401dde66a462c53b071c8fe39a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/stale.yml","hash":"05a55a87fa7f122c59683e41c8b2e37e79f688f0","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/404.pug","hash":"58cfa5985e58e10c97a9f8a9dc354f1c766154b3","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/archive.pug","hash":"bd62286afb64a51c97e800c5945620d51605d5fa","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/category.pug","hash":"60c1b795b6e227b5dd81963b51d29d1b81d0bf49","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/page.pug","hash":"82aa988527a11835e7ac86ce4f23b8cd20014dfa","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/post.pug","hash":"8d398c8925182699d9f2b9f1b727f06228488312","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/en.yml","hash":"cd333235ff1648a6bf58dfafc81f2c57672a15a5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/default.yml","hash":"7ca673fb629ea74f5ba5e75b4f0f95248cfb5090","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-TW.yml","hash":"79a50c40d9f5463f1fa42aa870ac6b8b84540412","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-CN.yml","hash":"741e522b2387f94764a73844e7b084cc7e927c54","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/bug_report.md","hash":"476802922b774b679225102ac30a9d9183394701","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/custom.md","hash":"eff495eb1584cf4586e33c76e8b2fa6a469a179b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/feature_request.md","hash":"f6867a2f0417fe89a0f2008730ee19dd38422021","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/additional-js.pug","hash":"4156224c47bfc2482281ac4e4df701c30476ff00","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/footer.pug","hash":"a83fd4f2e41d43034c722c317b9f024421115a49","modified":1665974841821},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head.pug","hash":"aa105ea4eaecc951f7474b549b6ac0095a5fab1f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/layout.pug","hash":"76d672c91f6bb6f20c6936e05067c42f7917ac61","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/404.js","hash":"3c30dbd8b910ce7d8d7d8353cf2266cbc5d8775d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/init.js","hash":"43b245c308797c2d62cb70429a85f1a05d3395ab","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/welcome.js","hash":"d575137c8779e50422c2416f4d0832fdea346ee6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/post_lazyload.js","hash":"e9cf275c362d8634f093e63068da7ed1e53c7600","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/random_cover.js","hash":"9821872007cf57efae4b728dc575ef9d004547bb","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/inject_head_js.js","hash":"81459adf885a15c6e9784bc2275c07efe67ab0b4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/page.js","hash":"1da73cd47b78c6dbc3f04ce500d6cc5711c94412","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/related_post.js","hash":"0d8ba6120dce617a2a1fbc9167572db2ee9f22ef","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/button.js","hash":"e75283267f3a4773e6d803593d557e218396f260","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/gallery.js","hash":"94826ea6bcc4d2304199adae12c4e2b272caf529","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/hide.js","hash":"f33858ffb9e88191e644796e11d2f901eb332308","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/mermaid.js","hash":"35f073021db93699fcac9ef351e26c59c31aadf7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/note.js","hash":"c16c6eb058af2b36bcd583b2591076c7ebdd51ad","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/pagination.pug","hash":"ec7ba875aaa2b95ab9d8256bd21c1e006bbe2820","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/rightside.pug","hash":"2d0453adf92a3fd3466cf0793f14685d17b8b51d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/sidebar.pug","hash":"2b34e587030516afe2faf1a8cb20aebaead012f1","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","hash":"861998e4ac67a59529a8245a9130d68f826c9c12","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","hash":"40c3f64422205a24e68ce1ad8fe8163f24fdd525","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","hash":"41481019ef510c74e744f4f7ec4d0a13b5ccc04c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","hash":"8b670bed658cf879e37a12d9fda064cf4b55cc3f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.png","hash":"56032826b861af1ac0bcf220f2ebc029207e31f5","modified":1725443942363},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/index.pug","hash":"44d231314d4bfffdb93096c1fa18d05de7293267","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/img/algolia.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/menu_item.pug","hash":"24370508ee87f14418e8f06e9d79ad8c52a342c4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/nav.pug","hash":"c205b9fd72b2fe19e6d15c5b5ab0fb38c653032e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/img/loading.gif","hash":"5f0287fb8fb98872fe1998c6f781111819e71806","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/social.pug","hash":"0d953e51d04a9294a64153c89c20f491a9ec42d4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/loading-js.pug","hash":"4cfcf0100e37ce91864703cd44f1cb99cb5493ea","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/Open_Graph.pug","hash":"6c41f49a3e682067533dd9384e6e4511fc3a1349","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/analytics.pug","hash":"90d01b88d0f406d00184960b1afe9230aec2ebe6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/post-info.pug","hash":"92f81a437c9db49f7ebcf608bc09488ecdb55a21","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config_site.pug","hash":"798dbbe9146e8e2379b39a49acf8c8a1eeabb8fb","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config.pug","hash":"4def0aab9e2172ad1f29abd1535d8e08ff23aa0b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/loading.pug","hash":"5276937fbcceb9d62879dc47be880cd469a27349","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/preconnect.pug","hash":"e55f8bdb876d5429a908498db1307b94094c0d06","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/site_verification.pug","hash":"62cf37e28795d8b68a0e850ec8c94987b9e08db5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/categories.pug","hash":"1f30952fed73dec21b42e2e30b7fe2e84618d2e4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/default-page.pug","hash":"dbec869c62135695495703a29ad7655e9965d461","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/flink.pug","hash":"45f0d36b1ac686b5984909dae55d3c522f549c3a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/tags.pug","hash":"93d4ebc7dc8228c7a10ddeb5a553d0dcdabbe145","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/article-sort.pug","hash":"68dfd3c6a0f00b3ffc0333c81e165b4626f7425f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/post-copyright.pug","hash":"88e3b611b03149665e4113cfa39595c1a3fca7e5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/reward.pug","hash":"edebe930a2e3c4a4de5a35b9c1b1409cdd401372","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/post-ui.pug","hash":"6058de23612ab1ed17d2ad93f5866d5f745135f0","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_announcement.pug","hash":"3d8e3706a056389176f55dd21956aabc78046761","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_author.pug","hash":"3e4e83a41a444f7454ff682620369a8af1f960c9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_newest_comment.pug","hash":"36b368516b5a746be84a6aa08767ee24d220d509","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_post_toc.pug","hash":"ae9336bf31cdad08ff586ead4295912a96563c76","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_recent_post.pug","hash":"e356f916ceb28702812d8f66c1fea0ae75eece47","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_tags.pug","hash":"438aea3e713ed16b7559b9a80a9c5ec0221263df","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_self.pug","hash":"a1b2f5575b6804c5c4b9288db143b5164cbbd289","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/index.pug","hash":"9e91f2543ab39815309268d07ae248a78887acf9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_webinfo.pug","hash":"0612aaee878f33ea8d3da0293c7dc3b6cd871466","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/aplayer.pug","hash":"292646dfab135973b09f0fa9e3931e83da2ed30e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/effect.pug","hash":"b9d54a01d7c2a7a183cb7209e99430ce7fea1fe3","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/pangu.pug","hash":"d5fec7dedc52ab23865fb4db002755e9bdaadc9f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/pjax.pug","hash":"5e3c9d25298ae3025b59dd4cb080259c0f8fab78","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/prismjs.pug","hash":"1fbecfd299068f90d727f0c8c65e2a792fa6e3e2","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/subtitle.pug","hash":"d50e5c22cd6bc3c378bc581918136746cfa3447f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/theme.styl","hash":"fa7a4c1685f391d60ed863e869b9604b59746c27","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/404.styl","hash":"d6548e332e6e57e2a7ba2eb53cdd838c3cd1846d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight.styl","hash":"ce3d0c8984c8a46e3c8e1727806bb4d37ff3e2d4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/chat.styl","hash":"29f48f9370f245e6e575b5836bccf47eb5688d8b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/comments.styl","hash":"f1b63892baafa48ab872bc79671d57aafd511f6c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/aside.styl","hash":"6317bc18152e474b8faa7994fc5fbc3c9e455a84","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/footer.styl","hash":"76669d8161b1f0534c0e91cf16fd76fc41fe091c","modified":1659106069252},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/loading.styl","hash":"7d18a7be9cfea65091de3ef00014063d2d649912","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/pagination.styl","hash":"90fe01c968696a9f791cb2b84fca621cbbb56f47","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/relatedposts.styl","hash":"0551c5893d1589a3d17ce161e50ecb1d724cc6e8","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/reward.styl","hash":"ea1ba40dd5954c2ed718a126336fb7f94da4e66f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/head.styl","hash":"b09e3a834ab8389f731bee5703b86e8aea27cda8","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/rightside.styl","hash":"7a072589e6097dbe942783131964f2372fdf1eb6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/third-party.styl","hash":"788a28f68e29fad5328dc03be2f3268324281652","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/post.styl","hash":"e639219e12069f9a71c8f325364a8f656454b999","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/sidebar.styl","hash":"7a6e1f21173022a3a1f18a62785cdd657a1af0a1","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/archives.styl","hash":"6874adc2e276443f354bbe50d0072e9bec37243c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/categories.styl","hash":"e554549f0a0ae85362f0b0e8687981741f486f6b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/flink.styl","hash":"d60b7a94a7adeac489b8c1afdf7e679994829742","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/common.styl","hash":"a6f8637e90e44e23338209d4a3438e3e67766971","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/homepage.styl","hash":"7c4152162a03aa8331a783df5695e4ebbb816a8c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/tags.styl","hash":"9a881c031f463c486bd25248c2814fd09f97892b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/gallery.styl","hash":"53ecae272e16223a436c497abbf25dd5f0fc4aaa","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hexo.styl","hash":"d0386ba6d8d63afc72b9673e8f3e89df6446ffc2","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hide.styl","hash":"21964fdd6d74ffbea519418bab65024aee5f3736","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/button.styl","hash":"a7fc7624a8d893bdf9444f14154484c29c790e99","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/note.styl","hash":"86fee274a62f7f034547342930f445c47378eb55","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/tabs.styl","hash":"1756791581c0ec51cb03353a09dac4778d944349","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/function.styl","hash":"eda47f3e807a466ba8275627ea936c5100c43818","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/darkmode.styl","hash":"d7717ce0c061b2471bf1a366c1a81158af266417","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/algolia.styl","hash":"6b05ca4409d2dc09e123af4e0af9f9d0f7142b73","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/readmode.styl","hash":"c2d35443807a121e20c7ac3c1caa50f848bacd59","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/index.styl","hash":"89e744abc5e41f4855e7b87b13b854f4ec4ffc0e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/local-search.styl","hash":"51f2bd03a2d0787911d0c090fb555a664b3fac8b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/index.styl","hash":"6ba9dcda7ff1ceda4e07c8c08517259e8b7dbcd5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","hash":"65b45e61586f7e66c3f338370bfd9daadd71a4b7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","hash":"459e2541afda483916d16fce4aaa56b41bcd42ba","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqus.pug","hash":"a111407fdcafcf1099e26ffa69786f8822c5d9fb","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"fd68563e649bd95529d4b3a828e430a9997f66ee","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"0b7571919e8ad51285deda56a1868fccf8c563d7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"353ebd0bdecdfde6dee32c3aa208cc87c72b15c0","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/index.pug","hash":"da9813f8dc0d388869c15413cf056012cfb69e1a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/js.pug","hash":"bafb3d5710824caa59a56017afb058fd2b4eac65","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"16378d8646ea3f4ac99c18f0296dd85b13f9d775","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/utterances.pug","hash":"b871ea208e36398b4d668db9a9a0b61c79415381","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/valine.pug","hash":"2b45fe09d5b591dca156b76dae99981f8d8e1c61","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/waline.pug","hash":"87b097f791f56ca17319657de7901853b798555d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"7848ec58c6ec03243abf80a3b22b4dc10f3edf53","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"ef1b2b5b980d6aeaa5d06b97d1afc9644b155a16","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"e3bf847553515174f6085df982f0623e9783db7a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"76c061a16d7e5935f02acd27c6cdb4933c642b97","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"bba9871f446c10ffcc8fa9023f5a2eb701a86bae","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/chatra.pug","hash":"481cd5053bafb1a19f623554a27d3aa077ea59c3","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/crisp.pug","hash":"76634112c64023177260d1317ae39cef2a68e35f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/index.pug","hash":"3f05f8311ae559d768ee3d0925e84ed767c314d3","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"cfe63e7d26a6665df6aa32ca90868ad48e05ec04","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/gitter.pug","hash":"d1d2474420bf4edc2e43ccdff6f92b8b082143df","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/tidio.pug","hash":"24a926756c2300b9c561aaab6bd3a71fdd16e16d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mathjax.pug","hash":"4afc12ce42d067fa4012039aa444343a36f73599","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"9820d731bb66a1d9c2e0083361d0c99c68c93fdf","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mermaid.pug","hash":"3f3a3cd8bea2103dedd754f767aca5cb84d5f586","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"a91df377d8ac227ff210cc5d0295648ba9daf6ed","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/katex.pug","hash":"21b7ec96c606823d3d72e72775495ef77502b4cb","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"18dcf05ab58107bbff426376aef2577f59583fc2","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"cb38ffe911023092a90a28f2ba8317a92b22cd0c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"59b4c26a827ace5a54855881d199977103ff6f50","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"9657b1b08ff3f98e49ca250ed47a81b8b202ac7a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/algolia.pug","hash":"d8f59e94eafc669c49349561dc5bbea3915aecb7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/index.pug","hash":"da3b9437d061ee68dbc383057db5c73034c49605","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/local-search.pug","hash":"613280d61b8ab9612014ec016ae3d3698d36fd1a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/addtoany.pug","hash":"309f51bc5302e72fc469d54c577fbcfe57fb07a8","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/share-js.pug","hash":"006acc91ce25fc7c7d778ca043e970f57dc46b83","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/diff.styl","hash":"8c0726fb8d9a497d2f900b0be2845efaa68e3d87","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/index.styl","hash":"89cbcc8e087788ecec18b5fa58710afacdb7d080","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/index.styl","hash":"e0e7065124ef0d99f8322a47bc47838982e04ad0","modified":499162500000},{"_id":"source/img/bg.jpg","hash":"6c5d3cade3bb1920835eec78e58675ba827227bb","modified":1658892079707},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":499162500000},{"_id":"source/img/scratch_custom/img-4.png","hash":"0b1808d29fc4674935c8cd95d40201105276cfb5","modified":1725430115758},{"_id":"source/img/scratch_custom/img-6.png","hash":"dd1902455f3500f3fc2d270934cdc6d7ec0bafff","modified":1725430534841},{"_id":"source/img/404.jpg","hash":"560fc553b5a14a75e1cc4316b5649d3566fd70bb","modified":1659105542210},{"_id":"source/img/bg-1.jpg","hash":"0a91c888f46f56e6082e8001236325f56a4ec8b6","modified":1658891979219},{"_id":"source/img/bg-2.jpg","hash":"757b17c40e79db275b77d254e3d78a37e308d3ec","modified":1658892006422},{"_id":"source/img/link.jpg","hash":"8e254ee265d15399798de2cdb87ce9cc74af0d69","modified":1659105429785},{"_id":"source/img/scratch_custom/scratch-bg.png","hash":"d61b8e9abb283e3afc97b88f40b225cdd1783231","modified":1725357699042},{"_id":"source/img/tutorials/tutorials-cover.png","hash":"7f74bf78ab5ea6a4dd2d78af65a1e1db816de8a6","modified":1725440483741},{"_id":"source/img/fix_tales/fix-tales-bg.png","hash":"0e7c00fb4c941339f70d6f49302c0c993737ae9f","modified":1725350793985},{"_id":"source/img/fix_tales/fix-tales-cover.png","hash":"5fc833373782648a8f1527d7983afdc289ce0901","modified":1725357719561},{"_id":"source/img/tutorials/tutorials-bg.png","hash":"7f9a2c62f35cb86b0db45b8c56120254b30c1837","modified":1725440483723},{"_id":"public/404.html","hash":"70dcd0f7673499179f0c62e454712421895fcbec","modified":1750127967348},{"_id":"public/comments/index.html","hash":"553a457eb052b67b1df1ec4c9e043d838c509e18","modified":1750127967348},{"_id":"public/gallery/wedding-main.html","hash":"9e48f7fffc8379d19994890fdf53de87f376ec7e","modified":1750127967348},{"_id":"public/gallery/index.html","hash":"91d0ab8267f4a51c802f0558da372a06463de4c6","modified":1750127967348},{"_id":"public/about/index.html","hash":"7bb0d1a884f318d66a3b19654bff3431a6c06b5c","modified":1750127967348},{"_id":"public/gallery/wedding-other.html","hash":"c641bbe3571534dc8baa8f6855b71596e2587fa4","modified":1750127967348},{"_id":"public/categories/index.html","hash":"af0ad4668f1aca9d14f60a12be0ab8443bb7f96a","modified":1750127967348},{"_id":"public/link/index.html","hash":"61745ddea783eb012d0ada4e9b823c47eb792759","modified":1750127967348},{"_id":"public/movies/index.html","hash":"66e5294af2ff812c61be9a3bab1e4cdf3ec53b67","modified":1750127967348},{"_id":"public/music/index.html","hash":"32dbbbc787b589a2f25bea34f80c4ffaab1a76f1","modified":1750127967348},{"_id":"public/2024/08/21/fix_tales_1/index.html","hash":"d7bc73a8cb28b3b4286274b05da2406b069679d2","modified":1750127804622},{"_id":"public/tags/index.html","hash":"7c6bb9cd09d3ca1346e3fc91a673892fd08e0655","modified":1750127967348},{"_id":"public/2024/08/15/scratch_custom_3/index.html","hash":"98cf470cfe4b3623c079b17720d3ce22f6d432bb","modified":1750127804622},{"_id":"public/2024/08/12/scratch_custom_2/index.html","hash":"c4fd06c9019cc3c8fecf10c0f2cb4efb3c6f8f39","modified":1750127804622},{"_id":"public/2024/08/11/scratch_custom_1/index.html","hash":"fc4946a5826f2368ab22b19a1bacd9542b16b371","modified":1750127804622},{"_id":"public/2022/06/18/tutorials_1/index.html","hash":"b30f168583b73cdac299df96613ef76769586c90","modified":1750127804622},{"_id":"public/index.html","hash":"9230f33375efaf7f1e4a483b7ee018a52689a907","modified":1750127967348},{"_id":"public/archives/index.html","hash":"a7fc98f980188674d1a4427942fa9ac0775b3d03","modified":1750127967348},{"_id":"public/archives/2022/index.html","hash":"2b22d53738d5b8848254e2ac7e1270f378e9c8ae","modified":1750127967348},{"_id":"public/archives/2022/06/index.html","hash":"884a891b7658c2ad4c461cb07f775409a872c804","modified":1750127967348},{"_id":"public/archives/2024/index.html","hash":"09fea19d4cdbb0ccf2d07aeca0736a68deacdf39","modified":1750127967348},{"_id":"public/archives/2024/08/index.html","hash":"7cd9a6cbb4f5d9f5669e4cbbc763d9288c2cdc5f","modified":1750127967348},{"_id":"public/categories/编海拾遗录/index.html","hash":"314c45bd2a1ccd8bc40e50d4e29c3005a256754d","modified":1750127967348},{"_id":"public/categories/创界编途·Scratch新章/index.html","hash":"1a8dab63bb35b3e0b7b2561db64a53caa355e83a","modified":1750127967348},{"_id":"public/categories/学海拾贝集/index.html","hash":"870af94d75eddbbdcc03943607c43aeb0a0bbef3","modified":1750127967348},{"_id":"public/img/algolia.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1725443672888},{"_id":"public/img/favicon.png","hash":"56032826b861af1ac0bcf220f2ebc029207e31f5","modified":1750127804622},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1725443672888},{"_id":"public/img/loading.gif","hash":"5f0287fb8fb98872fe1998c6f781111819e71806","modified":1725443672888},{"_id":"public/CNAME","hash":"aaa04ffbbb597c9bd20bb21814af704ad6f1e89d","modified":1725443672888},{"_id":"public/img/me.jpg","hash":"f62501f14480691dd4881f0304694cb71aacc366","modified":1725443672888},{"_id":"public/img/scratch_custom/img-3.png","hash":"cdf3d2f84414cecdc6bfe1ae87374d7fe7a6be7a","modified":1725443672888},{"_id":"public/img/scratch_custom/img-1.png","hash":"8eb16527bbf2c06dcd5ce24b3a06d22b9cb4267d","modified":1725443672888},{"_id":"public/js/utils.js","hash":"41481019ef510c74e744f4f7ec4d0a13b5ccc04c","modified":1725443672888},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1725443672888},{"_id":"public/js/search/local-search.js","hash":"459e2541afda483916d16fce4aaa56b41bcd42ba","modified":1725443672888},{"_id":"public/js/search/algolia.js","hash":"65b45e61586f7e66c3f338370bfd9daadd71a4b7","modified":1725443672888},{"_id":"public/css/index.css","hash":"36586534e01dca257cb2dc76708f3a7437f625be","modified":1725443672888},{"_id":"public/img/avatar.jpg","hash":"56032826b861af1ac0bcf220f2ebc029207e31f5","modified":1725443672888},{"_id":"public/img/dbg-2.jpg","hash":"4628394714666bd14205f5a00e1edc9cf563f530","modified":1725443672888},{"_id":"public/img/scratch_custom/img-2.png","hash":"41b349f336ac4c04431296558af2e8f246ac130c","modified":1725443672888},{"_id":"public/img/scratch_custom/img-5.png","hash":"5a97804ef846b1a818a5e237fd9c06352a376ab1","modified":1725443672888},{"_id":"public/js/main.js","hash":"8b670bed658cf879e37a12d9fda064cf4b55cc3f","modified":1725443672888},{"_id":"public/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":1725443672888},{"_id":"public/img/dbg-3.jpg","hash":"8fe2a0a85c2c6ae022507c4d472ea66f868e565f","modified":1725443672888},{"_id":"public/img/scratch_custom/scratch-cover.jpg","hash":"a51161f8570e1e8d6bc0d00626656e7109724cf1","modified":1725443672888},{"_id":"public/img/dbg-1.jpg","hash":"6d0f7d2d9c4b8362f7d2ec41b14d2e3aefd365ef","modified":1725443672888},{"_id":"public/img/scratch_custom/img-6.png","hash":"dd1902455f3500f3fc2d270934cdc6d7ec0bafff","modified":1725443672888},{"_id":"public/img/scratch_custom/img-4.png","hash":"0b1808d29fc4674935c8cd95d40201105276cfb5","modified":1725443672888},{"_id":"public/img/404.jpg","hash":"560fc553b5a14a75e1cc4316b5649d3566fd70bb","modified":1725443672888},{"_id":"public/img/bg.jpg","hash":"6c5d3cade3bb1920835eec78e58675ba827227bb","modified":1725443672888},{"_id":"public/img/bg-2.jpg","hash":"757b17c40e79db275b77d254e3d78a37e308d3ec","modified":1725443672888},{"_id":"public/img/bg-1.jpg","hash":"0a91c888f46f56e6082e8001236325f56a4ec8b6","modified":1725443672888},{"_id":"public/img/link.jpg","hash":"8e254ee265d15399798de2cdb87ce9cc74af0d69","modified":1725443672888},{"_id":"public/img/scratch_custom/scratch-bg.png","hash":"d61b8e9abb283e3afc97b88f40b225cdd1783231","modified":1725443672888},{"_id":"public/img/tutorials/tutorials-cover.png","hash":"7f74bf78ab5ea6a4dd2d78af65a1e1db816de8a6","modified":1725443672888},{"_id":"public/img/fix_tales/fix-tales-bg.png","hash":"0e7c00fb4c941339f70d6f49302c0c993737ae9f","modified":1725443672888},{"_id":"public/img/fix_tales/fix-tales-cover.png","hash":"5fc833373782648a8f1527d7983afdc289ce0901","modified":1725443672888},{"_id":"public/img/tutorials/tutorials-bg.png","hash":"7f9a2c62f35cb86b0db45b8c56120254b30c1837","modified":1725443672888}],"Category":[{"name":"编海拾遗录","_id":"cm0nom53i0004az7dcn392kje"},{"name":"创界编途·Scratch新章","_id":"cm0nom53l0009az7dbken2x4u"},{"name":"学海拾贝集","_id":"cm0nom53w000laz7dh987h8va"}],"Data":[{"_id":"link","data":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}],"Page":[{"title":"留言板","date":"2022-07-28T21:58:41.000Z","type":"comments","top_img":"/img/bg-1.jpg","_content":"","source":"comments/index.md","raw":"---\ntitle: 留言板\ndate: 2022-07-29 05:58:41\ntype: \"comments\"\ntop_img: /img/bg-1.jpg\n---\n","updated":"2022-07-29T14:01:46.949Z","path":"comments/index.html","comments":1,"layout":"page","_id":"cm0nom53a0000az7d4bv89uif","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg","excerpt":"","more":""},{"title":"相册","date":"2022-07-27T22:28:50.000Z","type":"gallery","top_img":"/img/bg-2.jpg","_content":"\n<div class=\"gallery-group-main\">\n{% galleryGroup '婚纱照-主纱' '我们的婚纱照' '/gallery/wedding-main' http://www.yushenjian.com/Wedding%20photos/wedding-bg.jpg %}\n{% galleryGroup '婚纱照-其他' '我们的婚纱照' '/gallery/wedding-other' https://i.loli.net/2019/12/25/8t97aVlp4hgyBGu.jpg %}\n{% galleryGroup 'OH MY GIRL' '关于OH MY GIRL的图片' '/Gallery/ohmygirl' https://i.loli.net/2019/12/25/hOqbQ3BIwa6KWpo.jpg %}\n</div>","source":"gallery/index.md","raw":"---\ntitle: 相册\ndate: 2022-07-28 06:28:50\ntype: \"gallery\"\ntop_img: /img/bg-2.jpg\n---\n\n<div class=\"gallery-group-main\">\n{% galleryGroup '婚纱照-主纱' '我们的婚纱照' '/gallery/wedding-main' http://www.yushenjian.com/Wedding%20photos/wedding-bg.jpg %}\n{% galleryGroup '婚纱照-其他' '我们的婚纱照' '/gallery/wedding-other' https://i.loli.net/2019/12/25/8t97aVlp4hgyBGu.jpg %}\n{% galleryGroup 'OH MY GIRL' '关于OH MY GIRL的图片' '/Gallery/ohmygirl' https://i.loli.net/2019/12/25/hOqbQ3BIwa6KWpo.jpg %}\n</div>","updated":"2023-05-29T07:19:42.537Z","path":"gallery/index.html","comments":1,"layout":"page","_id":"cm0nom53h0002az7dfeob73zm","content":"<div class=\"gallery-group-main\">\n\n  <figure class=\"gallery-group\">\n  <img class=\"gallery-group-img\" src='http://www.yushenjian.com/Wedding%20photos/wedding-bg.jpg' alt=\"Group Image Gallery\">\n  <figcaption>\n  <div class=\"gallery-group-name\">婚纱照-主纱</div>\n  <p>我们的婚纱照</p>\n  <a href='/gallery/wedding-main'></a>\n  </figcaption>\n  </figure>\n  \n\n  <figure class=\"gallery-group\">\n  <img class=\"gallery-group-img\" src='https://i.loli.net/2019/12/25/8t97aVlp4hgyBGu.jpg' alt=\"Group Image Gallery\">\n  <figcaption>\n  <div class=\"gallery-group-name\">婚纱照-其他</div>\n  <p>我们的婚纱照</p>\n  <a href='/gallery/wedding-other'></a>\n  </figcaption>\n  </figure>\n  \n\n  <figure class=\"gallery-group\">\n  <img class=\"gallery-group-img\" src='https://i.loli.net/2019/12/25/hOqbQ3BIwa6KWpo.jpg' alt=\"Group Image Gallery\">\n  <figcaption>\n  <div class=\"gallery-group-name\">OH MY GIRL</div>\n  <p>关于OH MY GIRL的图片</p>\n  <a href='/Gallery/ohmygirl'></a>\n  </figcaption>\n  </figure>\n  \n</div>","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg","excerpt":"","more":"<div class=\"gallery-group-main\">\n\n  <figure class=\"gallery-group\">\n  <img class=\"gallery-group-img\" src='http://www.yushenjian.com/Wedding%20photos/wedding-bg.jpg' alt=\"Group Image Gallery\">\n  <figcaption>\n  <div class=\"gallery-group-name\">婚纱照-主纱</div>\n  <p>我们的婚纱照</p>\n  <a href='/gallery/wedding-main'></a>\n  </figcaption>\n  </figure>\n  \n\n  <figure class=\"gallery-group\">\n  <img class=\"gallery-group-img\" src='https://i.loli.net/2019/12/25/8t97aVlp4hgyBGu.jpg' alt=\"Group Image Gallery\">\n  <figcaption>\n  <div class=\"gallery-group-name\">婚纱照-其他</div>\n  <p>我们的婚纱照</p>\n  <a href='/gallery/wedding-other'></a>\n  </figcaption>\n  </figure>\n  \n\n  <figure class=\"gallery-group\">\n  <img class=\"gallery-group-img\" src='https://i.loli.net/2019/12/25/hOqbQ3BIwa6KWpo.jpg' alt=\"Group Image Gallery\">\n  <figcaption>\n  <div class=\"gallery-group-name\">OH MY GIRL</div>\n  <p>关于OH MY GIRL的图片</p>\n  <a href='/Gallery/ohmygirl'></a>\n  </figcaption>\n  </figure>\n  \n</div>"},{"title":"婚纱照-主纱","date":"2023-05-21T10:18:18.000Z","type":"photos","top_img":"/img/photosbg.jpg","_content":"\n{% gallery %}\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2491.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2521.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2497.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2532.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2540.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2542.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2546.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2547.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2553.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2608.jpg)\n<!-- ![](http://www.yushenjian.com/Wedding%20photos/GR9A2621.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2633.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2641.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2683.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2706.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2720.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2726.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2728.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2739.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2754.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2760.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2764.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2771.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2773.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2774.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2779.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2786.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2789.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2815.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2833.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2900.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3078.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3081.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3083.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3146.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3150.jpg) -->\n{% endgallery %}","source":"gallery/wedding-main.md","raw":"---\ntitle: 婚纱照-主纱\ndate: 2023-05-21 18:18:18\ntype: \"photos\"\ntop_img: /img/photosbg.jpg\n---\n\n{% gallery %}\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2491.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2521.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2497.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2532.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2540.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2542.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2546.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2547.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2553.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2608.jpg)\n<!-- ![](http://www.yushenjian.com/Wedding%20photos/GR9A2621.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2633.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2641.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2683.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2706.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2720.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2726.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2728.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2739.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2754.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2760.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2764.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2771.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2773.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2774.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2779.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2786.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2789.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2815.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2833.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2900.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3078.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3081.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3083.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3146.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3150.jpg) -->\n{% endgallery %}","updated":"2023-06-29T00:58:27.186Z","path":"gallery/wedding-main.html","comments":1,"layout":"page","_id":"cm0nom53j0005az7dc6oe5pcb","content":"<div class=\"justified-gallery\"><p><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2491.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2521.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2497.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2532.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2540.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2542.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2546.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2547.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2553.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2608.jpg\"></p><!-- ![](http://www.yushenjian.com/Wedding%20photos/GR9A2621.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2633.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2641.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2683.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2706.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2720.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2726.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2728.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2739.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2754.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2760.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2764.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2771.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2773.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2774.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2779.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2786.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2789.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2815.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2833.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2900.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A3078.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A3081.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A3083.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A3146.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A3150.jpg) -->\n          </div>","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg","excerpt":"","more":"<div class=\"justified-gallery\"><p><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2491.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2521.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2497.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2532.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2540.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2542.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2546.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2547.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2553.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2608.jpg\"></p><!-- ![](http://www.yushenjian.com/Wedding%20photos/GR9A2621.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2633.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2641.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2683.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2706.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2720.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2726.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2728.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2739.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2754.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2760.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2764.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2771.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2773.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2774.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2779.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2786.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2789.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2815.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2833.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A2900.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A3078.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A3081.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A3083.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A3146.jpg)![](http://www.yushenjian.com/Wedding%20photos/GR9A3150.jpg) -->\n          </div>"},{"title":"关于","date":"2022-07-28T22:08:06.000Z","type":"about","top_img":"/img/me.jpg","_content":"","source":"about/index.md","raw":"---\ntitle: 关于\ndate: 2022-07-29 06:08:06\ntype: \"about\"\ntop_img: /img/me.jpg\n---\n","updated":"2022-07-29T14:48:52.119Z","path":"about/index.html","comments":1,"layout":"page","_id":"cm0nom53k0007az7dcoc44aqe","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg","excerpt":"","more":""},{"title":"婚纱照-其他","date":"2023-05-21T10:18:18.000Z","type":"photos","top_img":"/img/photosbg.jpg","_content":"\n{% gallery %}\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2754.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2771.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2773.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2779.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2786.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2789.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2815.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2833.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2900.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3078.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3083.jpg)\n{% endgallery %}","source":"gallery/wedding-other.md","raw":"---\ntitle: 婚纱照-其他\ndate: 2023-05-21 18:18:18\ntype: \"photos\"\ntop_img: /img/photosbg.jpg\n---\n\n{% gallery %}\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2754.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2771.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2773.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2779.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2786.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2789.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2815.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2833.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A2900.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3078.jpg)\n![](http://www.yushenjian.com/Wedding%20photos/GR9A3083.jpg)\n{% endgallery %}","updated":"2023-05-29T07:26:16.519Z","path":"gallery/wedding-other.html","comments":1,"layout":"page","_id":"cm0nom53k0008az7d2stkcnr7","content":"<div class=\"justified-gallery\"><p><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2754.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2771.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2773.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2779.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2786.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2789.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2815.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2833.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2900.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A3078.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A3083.jpg\"></p>\n          </div>","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg","excerpt":"","more":"<div class=\"justified-gallery\"><p><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2754.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2771.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2773.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2779.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2786.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2789.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2815.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2833.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A2900.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A3078.jpg\"><br><img src=\"http://www.yushenjian.com/Wedding%20photos/GR9A3083.jpg\"></p>\n          </div>"},{"title":"分类","date":"2022-07-27T22:15:14.000Z","type":"categories","top_img":"/img/bg-1.jpg","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2022-07-28 06:15:14\ntype: \"categories\"\ntop_img: /img/bg-1.jpg\n---\n","updated":"2022-07-29T11:18:41.263Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cm0nom53l000aaz7deirk6jsm","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg","excerpt":"","more":""},{"title":"友情链接","date":"2022-07-27T22:15:58.000Z","type":"link","top_img":"/img/link.jpg","_content":"","source":"link/index.md","raw":"---\ntitle: 友情链接\ndate: 2022-07-28 06:15:58\ntype: \"link\"\ntop_img: /img/link.jpg\n---\n","updated":"2022-07-29T14:38:06.669Z","path":"link/index.html","comments":1,"layout":"page","_id":"cm0nom53l000baz7d040j5srs","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg","excerpt":"","more":""},{"title":"电影","date":"2022-07-28T22:03:22.000Z","type":"movies","top_img":"/img/bg-2.jpg","_content":"","source":"movies/index.md","raw":"---\ntitle: 电影\ndate: 2022-07-29 06:03:22\ntype: \"movies\"\ntop_img: /img/bg-2.jpg\n---\n","updated":"2022-07-29T14:04:36.118Z","path":"movies/index.html","comments":1,"layout":"page","_id":"cm0nom53o000eaz7dgt5i7e94","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg","excerpt":"","more":""},{"title":"音乐","date":"2022-07-28T22:03:07.000Z","type":"music","top_img":"/img/bg-2.jpg","_content":"","source":"music/index.md","raw":"---\ntitle: 音乐\ndate: 2022-07-29 06:03:07\ntype: \"music\"\ntop_img: /img/bg-2.jpg\n---\n","updated":"2022-07-29T14:04:22.109Z","path":"music/index.html","comments":1,"layout":"page","_id":"cm0nom53p000faz7db1x4754s","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg","excerpt":"","more":""},{"title":"标签","date":"2022-07-27T22:14:32.000Z","type":"tags","top_img":"/img/bg-1.jpg","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2022-07-28 06:14:32\ntype: \"tags\"\ntop_img: /img/bg-1.jpg\n---\n","updated":"2022-07-29T11:18:33.052Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cm0nom53q000haz7deawyduv6","content":"","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":"https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg","excerpt":"","more":""}],"Post":[{"title":"解决苹果手机<audio>标签播放错误","date":"2024-08-20T16:00:00.000Z","updated":"2024-08-20T16:00:00.000Z","keywords":"编海拾遗录","top_img":"/img/fix_tales/fix-tales-bg.png","cover":"/img/fix_tales/fix-tales-cover.png","_content":"\n在开发过程中，我遇到了一个棘手的问题。在一个项目中，我需要在网页上播放音频文件，使用了标准的`audio`标签。在大部分设备上，这个功能都能正常工作，但当我在苹果手机（iOS设备）上测试时，却发现音频根本无法播放。\n\n## 挫折与困惑\n\n当时，我尝试了很多方法来解决这个问题，甚至开始怀疑是不是音频文件格式不对，或者是代码的其他部分出了问题。我检查了音频的格式，确保它是MP3，而且代码在其他平台上运行良好，这一切都让我感到更加困惑。\n\n我开始怀疑是不是因为苹果设备对音频处理的方式有所不同，于是我查阅了大量的资料，试图找到问题的根源。\n\n## 寻找解决方法\n\n在经过搜索和实验后，我偶然发现了一个关于ID3标签的讨论。有开发者提到，苹果手机可能无法正确解析含有ID3标签的音频文件，看到这条信息时，我的直觉告诉我这可能就是问题的关键所在。\n\n接下来，我便开始寻找解决方案。幸运的是，我找到了一个名为`browser-id3-writer`的JavaScript库，它可以帮助我操作和移除音频文件中的ID3标签。\n\n## 实施解决方案\n\n于是，我决定尝试一下这个库。首先，我通过npm安装了`browser-id3-writer`：\n\n```bash\nnpm install browser-id3-writer --save\n```\n\n安装完成后，我编写了一个方法，使用这个库来移除音频文件中的ID3标签。代码如下：\n\n\n```javascript\nimport { ID3Writer } from 'browser-id3-writer'\n\nasync function removeID3Tags(audioUrl) {\n  try {\n    // 获取音频文件的ArrayBuffer\n    const response = await fetch(audioUrl)\n    const arrayBuffer = await response.arrayBuffer()\n    \n    // 创建ID3Writer实例并移除ID3标签\n    const writer = new ID3Writer(new Uint8Array(arrayBuffer))\n    writer.removeTag() // 移除 ID3 标签\n    const cleanedArrayBuffer = writer.arrayBuffer\n    \n    // 将处理后的音频文件转为 Blob\n    const cleanedAudioBlob = new Blob([cleanedArrayBuffer], { type: 'audio/mp3' })\n    \n    // 上传处理后的音频文件并获取新的URL\n    const res = await uploadOss.UploadMusic(cleanedAudioBlob)\n    console.log(res, 'res')\n    \n    // 返回处理后的音频URL\n    return res\n  } catch (error) {\n    console.error('Failed to remove ID3 tags:', error)\n    // 发生错误时返回原始的音频URL\n    return audioUrl\n  }\n}\n```\n\n在这个方法中，我首先通过fetch获取音频文件的数据，并使用ID3Writer移除ID3标签。然后，我将处理后的音频数据上传到服务器，最后获取一个新的URL，用于在网页中播放音频。\n\n这一次终于找到了问题的症结，苹果手机上音频终于能够正常播放了。\n\n## 反思与总结\n\n通过这次经历，我不仅解决了一个技术问题，也学到了很多新的知识，特别是在音频处理和跨平台兼容性方面。希望我的经验能帮助到遇到类似问题的开发者，也希望大家在开发的路上少一些挫折，多一些收获。","source":"_posts/fix_tales_1.md","raw":"---\ntitle: 解决苹果手机<audio>标签播放错误\ndate: 2024-08-21\nupdated: 2024-08-21\ncategories: 编海拾遗录\nkeywords: 编海拾遗录\ntop_img: /img/fix_tales/fix-tales-bg.png\ncover: /img/fix_tales/fix-tales-cover.png\n---\n\n在开发过程中，我遇到了一个棘手的问题。在一个项目中，我需要在网页上播放音频文件，使用了标准的`audio`标签。在大部分设备上，这个功能都能正常工作，但当我在苹果手机（iOS设备）上测试时，却发现音频根本无法播放。\n\n## 挫折与困惑\n\n当时，我尝试了很多方法来解决这个问题，甚至开始怀疑是不是音频文件格式不对，或者是代码的其他部分出了问题。我检查了音频的格式，确保它是MP3，而且代码在其他平台上运行良好，这一切都让我感到更加困惑。\n\n我开始怀疑是不是因为苹果设备对音频处理的方式有所不同，于是我查阅了大量的资料，试图找到问题的根源。\n\n## 寻找解决方法\n\n在经过搜索和实验后，我偶然发现了一个关于ID3标签的讨论。有开发者提到，苹果手机可能无法正确解析含有ID3标签的音频文件，看到这条信息时，我的直觉告诉我这可能就是问题的关键所在。\n\n接下来，我便开始寻找解决方案。幸运的是，我找到了一个名为`browser-id3-writer`的JavaScript库，它可以帮助我操作和移除音频文件中的ID3标签。\n\n## 实施解决方案\n\n于是，我决定尝试一下这个库。首先，我通过npm安装了`browser-id3-writer`：\n\n```bash\nnpm install browser-id3-writer --save\n```\n\n安装完成后，我编写了一个方法，使用这个库来移除音频文件中的ID3标签。代码如下：\n\n\n```javascript\nimport { ID3Writer } from 'browser-id3-writer'\n\nasync function removeID3Tags(audioUrl) {\n  try {\n    // 获取音频文件的ArrayBuffer\n    const response = await fetch(audioUrl)\n    const arrayBuffer = await response.arrayBuffer()\n    \n    // 创建ID3Writer实例并移除ID3标签\n    const writer = new ID3Writer(new Uint8Array(arrayBuffer))\n    writer.removeTag() // 移除 ID3 标签\n    const cleanedArrayBuffer = writer.arrayBuffer\n    \n    // 将处理后的音频文件转为 Blob\n    const cleanedAudioBlob = new Blob([cleanedArrayBuffer], { type: 'audio/mp3' })\n    \n    // 上传处理后的音频文件并获取新的URL\n    const res = await uploadOss.UploadMusic(cleanedAudioBlob)\n    console.log(res, 'res')\n    \n    // 返回处理后的音频URL\n    return res\n  } catch (error) {\n    console.error('Failed to remove ID3 tags:', error)\n    // 发生错误时返回原始的音频URL\n    return audioUrl\n  }\n}\n```\n\n在这个方法中，我首先通过fetch获取音频文件的数据，并使用ID3Writer移除ID3标签。然后，我将处理后的音频数据上传到服务器，最后获取一个新的URL，用于在网页中播放音频。\n\n这一次终于找到了问题的症结，苹果手机上音频终于能够正常播放了。\n\n## 反思与总结\n\n通过这次经历，我不仅解决了一个技术问题，也学到了很多新的知识，特别是在音频处理和跨平台兼容性方面。希望我的经验能帮助到遇到类似问题的开发者，也希望大家在开发的路上少一些挫折，多一些收获。","slug":"fix_tales_1","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cm0nom53d0001az7dhlbxh1rq","content":"<p>在开发过程中，我遇到了一个棘手的问题。在一个项目中，我需要在网页上播放音频文件，使用了标准的<code>audio</code>标签。在大部分设备上，这个功能都能正常工作，但当我在苹果手机（iOS设备）上测试时，却发现音频根本无法播放。</p>\n<h2 id=\"挫折与困惑\"><a href=\"#挫折与困惑\" class=\"headerlink\" title=\"挫折与困惑\"></a>挫折与困惑</h2><p>当时，我尝试了很多方法来解决这个问题，甚至开始怀疑是不是音频文件格式不对，或者是代码的其他部分出了问题。我检查了音频的格式，确保它是MP3，而且代码在其他平台上运行良好，这一切都让我感到更加困惑。</p>\n<p>我开始怀疑是不是因为苹果设备对音频处理的方式有所不同，于是我查阅了大量的资料，试图找到问题的根源。</p>\n<h2 id=\"寻找解决方法\"><a href=\"#寻找解决方法\" class=\"headerlink\" title=\"寻找解决方法\"></a>寻找解决方法</h2><p>在经过搜索和实验后，我偶然发现了一个关于ID3标签的讨论。有开发者提到，苹果手机可能无法正确解析含有ID3标签的音频文件，看到这条信息时，我的直觉告诉我这可能就是问题的关键所在。</p>\n<p>接下来，我便开始寻找解决方案。幸运的是，我找到了一个名为<code>browser-id3-writer</code>的JavaScript库，它可以帮助我操作和移除音频文件中的ID3标签。</p>\n<h2 id=\"实施解决方案\"><a href=\"#实施解决方案\" class=\"headerlink\" title=\"实施解决方案\"></a>实施解决方案</h2><p>于是，我决定尝试一下这个库。首先，我通过npm安装了<code>browser-id3-writer</code>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install browser-id3-writer --save</span><br></pre></td></tr></table></figure>\n\n<p>安装完成后，我编写了一个方法，使用这个库来移除音频文件中的ID3标签。代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">ID3Writer</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;browser-id3-writer&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">removeID3Tags</span>(<span class=\"params\">audioUrl</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取音频文件的ArrayBuffer</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(audioUrl)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> arrayBuffer = <span class=\"keyword\">await</span> response.<span class=\"title function_\">arrayBuffer</span>()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 创建ID3Writer实例并移除ID3标签</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> writer = <span class=\"keyword\">new</span> <span class=\"title class_\">ID3Writer</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(arrayBuffer))</span><br><span class=\"line\">    writer.<span class=\"title function_\">removeTag</span>() <span class=\"comment\">// 移除 ID3 标签</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> cleanedArrayBuffer = writer.<span class=\"property\">arrayBuffer</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 将处理后的音频文件转为 Blob</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> cleanedAudioBlob = <span class=\"keyword\">new</span> <span class=\"title class_\">Blob</span>([cleanedArrayBuffer], &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;audio/mp3&#x27;</span> &#125;)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 上传处理后的音频文件并获取新的URL</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> res = <span class=\"keyword\">await</span> uploadOss.<span class=\"title class_\">UploadMusic</span>(cleanedAudioBlob)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res, <span class=\"string\">&#x27;res&#x27;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 返回处理后的音频URL</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> res</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Failed to remove ID3 tags:&#x27;</span>, error)</span><br><span class=\"line\">    <span class=\"comment\">// 发生错误时返回原始的音频URL</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> audioUrl</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这个方法中，我首先通过fetch获取音频文件的数据，并使用ID3Writer移除ID3标签。然后，我将处理后的音频数据上传到服务器，最后获取一个新的URL，用于在网页中播放音频。</p>\n<p>这一次终于找到了问题的症结，苹果手机上音频终于能够正常播放了。</p>\n<h2 id=\"反思与总结\"><a href=\"#反思与总结\" class=\"headerlink\" title=\"反思与总结\"></a>反思与总结</h2><p>通过这次经历，我不仅解决了一个技术问题，也学到了很多新的知识，特别是在音频处理和跨平台兼容性方面。希望我的经验能帮助到遇到类似问题的开发者，也希望大家在开发的路上少一些挫折，多一些收获。</p>\n","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"excerpt":"","more":"<p>在开发过程中，我遇到了一个棘手的问题。在一个项目中，我需要在网页上播放音频文件，使用了标准的<code>audio</code>标签。在大部分设备上，这个功能都能正常工作，但当我在苹果手机（iOS设备）上测试时，却发现音频根本无法播放。</p>\n<h2 id=\"挫折与困惑\"><a href=\"#挫折与困惑\" class=\"headerlink\" title=\"挫折与困惑\"></a>挫折与困惑</h2><p>当时，我尝试了很多方法来解决这个问题，甚至开始怀疑是不是音频文件格式不对，或者是代码的其他部分出了问题。我检查了音频的格式，确保它是MP3，而且代码在其他平台上运行良好，这一切都让我感到更加困惑。</p>\n<p>我开始怀疑是不是因为苹果设备对音频处理的方式有所不同，于是我查阅了大量的资料，试图找到问题的根源。</p>\n<h2 id=\"寻找解决方法\"><a href=\"#寻找解决方法\" class=\"headerlink\" title=\"寻找解决方法\"></a>寻找解决方法</h2><p>在经过搜索和实验后，我偶然发现了一个关于ID3标签的讨论。有开发者提到，苹果手机可能无法正确解析含有ID3标签的音频文件，看到这条信息时，我的直觉告诉我这可能就是问题的关键所在。</p>\n<p>接下来，我便开始寻找解决方案。幸运的是，我找到了一个名为<code>browser-id3-writer</code>的JavaScript库，它可以帮助我操作和移除音频文件中的ID3标签。</p>\n<h2 id=\"实施解决方案\"><a href=\"#实施解决方案\" class=\"headerlink\" title=\"实施解决方案\"></a>实施解决方案</h2><p>于是，我决定尝试一下这个库。首先，我通过npm安装了<code>browser-id3-writer</code>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install browser-id3-writer --save</span><br></pre></td></tr></table></figure>\n\n<p>安装完成后，我编写了一个方法，使用这个库来移除音频文件中的ID3标签。代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">ID3Writer</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;browser-id3-writer&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">removeID3Tags</span>(<span class=\"params\">audioUrl</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取音频文件的ArrayBuffer</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(audioUrl)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> arrayBuffer = <span class=\"keyword\">await</span> response.<span class=\"title function_\">arrayBuffer</span>()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 创建ID3Writer实例并移除ID3标签</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> writer = <span class=\"keyword\">new</span> <span class=\"title class_\">ID3Writer</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(arrayBuffer))</span><br><span class=\"line\">    writer.<span class=\"title function_\">removeTag</span>() <span class=\"comment\">// 移除 ID3 标签</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> cleanedArrayBuffer = writer.<span class=\"property\">arrayBuffer</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 将处理后的音频文件转为 Blob</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> cleanedAudioBlob = <span class=\"keyword\">new</span> <span class=\"title class_\">Blob</span>([cleanedArrayBuffer], &#123; <span class=\"attr\">type</span>: <span class=\"string\">&#x27;audio/mp3&#x27;</span> &#125;)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 上传处理后的音频文件并获取新的URL</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> res = <span class=\"keyword\">await</span> uploadOss.<span class=\"title class_\">UploadMusic</span>(cleanedAudioBlob)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res, <span class=\"string\">&#x27;res&#x27;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 返回处理后的音频URL</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> res</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Failed to remove ID3 tags:&#x27;</span>, error)</span><br><span class=\"line\">    <span class=\"comment\">// 发生错误时返回原始的音频URL</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> audioUrl</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这个方法中，我首先通过fetch获取音频文件的数据，并使用ID3Writer移除ID3标签。然后，我将处理后的音频数据上传到服务器，最后获取一个新的URL，用于在网页中播放音频。</p>\n<p>这一次终于找到了问题的症结，苹果手机上音频终于能够正常播放了。</p>\n<h2 id=\"反思与总结\"><a href=\"#反思与总结\" class=\"headerlink\" title=\"反思与总结\"></a>反思与总结</h2><p>通过这次经历，我不仅解决了一个技术问题，也学到了很多新的知识，特别是在音频处理和跨平台兼容性方面。希望我的经验能帮助到遇到类似问题的开发者，也希望大家在开发的路上少一些挫折，多一些收获。</p>\n"},{"title":"通过文生图模型在 Scratch 3 角色区生成图片","date":"2024-08-10T16:00:00.000Z","updated":"2024-08-10T16:00:00.000Z","keywords":"创界编途·Scratch新章","top_img":"/img/scratch_custom/scratch-bg.png","cover":"/img/scratch_custom/scratch-cover.jpg","_content":"\n在进行 Scratch 3 的二次开发过程中，我遇到了一个特别棘手的问题：如何通过文生图模型生成的图片，在 Scratch 的角色区成功添加一个新的角色。看似简单的任务背后，却隐藏着不少意想不到的困难。以下是我解决这个问题的完整经历。\n\n## 遇到的问题\n\n起初，我的目标很明确——通过文本生成图片，并将该图片添加为一个新的角色到 Scratch 的角色区。然而，实际操作过程中，我遭遇了多个问题：\n\n1. **图片的处理**：将通过文生图模型生成的图片 URL 转换为 Scratch 可以识别和使用的角色数据，过程中涉及到图片的加载、数据格式的转换，以及图片与 Scratch 内部数据结构的对接，这一步的复杂程度超出了我的预期。\n\n2. **角色的创建与渲染**：在 Scratch 中，添加新角色不仅仅是将图片插入这么简单，它需要严格遵守 Scratch 的角色生成与渲染机制。我在这一步中多次遇到渲染失败的情况，角色始终无法正确显示在舞台上。\n\n3. **层次管理**：Scratch 的角色具有层次关系，如何在不影响其他角色的前提下正确设置新角色的层次顺序，也是一个必须解决的问题。\n\n## 解决方法\n\n经过多次调试与查阅文档，我逐渐理清了问题的脉络，并最终找到了有效的解决方法。以下是关键的代码片段及其背后的思路：\n\n```javascript\nasync TextGeneratedPic(args, util) {\n    const imageUrl = this.imageUrl // 通过文生图模型获取的图片url\n    await this.addNewSprite(imageUrl, util)\n}\n```\n\n图片处理与角色创建\n\n首先，我编写了 addNewSprite 方法，负责将生成的图片转换为 Scratch 可以识别的格式，并创建新角色。\n\n```javascript\nasync addNewSprite(imageUrl, util) {\n    try {\n        const response = await fetch(imageUrl)\n        const blob = await response.blob()\n        const imageBitmap = await createImageBitmap(blob)\n        const extractedContent = imageUrl.split('.png')[0]\n        const md5 = extractedContent\n\n        // 创建 canvas，将图片绘制到 canvas 上\n        const canvas = document.createElement('canvas')\n        canvas.width = imageBitmap.width\n        canvas.height = imageBitmap.height\n        const context = canvas.getContext('2d')\n        context.drawImage(imageBitmap, 0, 0)\n\n        // 将 canvas 转换为 Base64 格式\n        const pngDataUrl = canvas.toDataURL('image/png')\n        const base64Data = pngDataUrl.split(',')[1]\n\n        // 将 Base64 数据转换为二进制数据\n        const binaryString = atob(base64Data)\n        const binaryLen = binaryString.length\n        const bytes = new Uint8Array(binaryLen)\n        for (let i = 0; i < binaryLen; i++) {\n            const ascii = binaryString.charCodeAt(i)\n            bytes[i] = ascii\n        }\n\n        // 创建角色的 costume 对象\n        const costume = {\n            asset: null,\n            md5: `${md5}.png`,\n            name: this.fileName + new Date().getTime(),\n            bitmapResolution: 2,\n            rotationCenterX: imageBitmap.width / 2,\n            rotationCenterY: imageBitmap.height / 2,\n            skinId: null,\n            dataFormat: 'png'\n        }\n\n        // 处理图片资源\n        const storage = this.runtime.storage\n        const asset = storage.createAsset(\n            AssetType.ImageBitmap,\n            'png',\n            bytes,\n            md5\n        )\n        costume.asset = asset\n        costume.assetId = asset.assetId\n\n        // 渲染新角色\n        const skinId = await this.runtime.renderer.createBitmapSkin(imageBitmap, costume.bitmapResolution)\n        costume.skinId = skinId\n\n        const spriteName = this.dddabc\n        const sprite = new Sprite(null, this.runtime)\n        sprite.costumes = [costume]\n        sprite.name = spriteName + new Date().getTime()\n        sprite.sounds = []\n        sprite.variables = {}\n        sprite.lists = {}\n        sprite.broadcasts = {}\n        sprite.comments = {}\n        sprite.clones = []\n        sprite.layerOrder = 0\n\n        const blocks = new Blocks(this.runtime, sprite)\n        blocks.forceNoGlow = false\n        sprite.blocks = blocks\n\n        const target = new RenderedTarget(sprite, this.runtime)\n        target.id = uid()\n        target.blocks = blocks\n        target.runtime = this.runtime\n\n        sprite.clones.push(target)\n\n        const group = 'sprite'\n        if (this.runtime.renderer._layerGroups && this.runtime.renderer._layerGroups[group]) {\n            const drawableID = this.runtime.renderer.createDrawable(group)\n            if (drawableID === undefined) {\n                console.error('Failed to create drawable')\n                return\n            }\n\n            target.drawableID = drawableID\n            this.runtime.renderer.updateDrawableSkinId(drawableID, skinId)\n            target.setVisible(true)\n\n            let maxLayerOrder = 0\n            for (let i = 0; i < this.runtime.targets.length; i++) {\n                if (!this.runtime.targets[i].isStage && this.runtime.targets[i].sprite.layerOrder > maxLayerOrder) {\n                    maxLayerOrder = this.runtime.targets[i].sprite.layerOrder\n                }\n            }\n            target.sprite.layerOrder = maxLayerOrder + 1\n\n            this.runtime.addTarget(target)\n            this.runtime.setEditingTarget(target.id)\n\n            this.runtime.emit(\"SAY\", util.target, \"say\", '')\n            console.log('角色已成功添加')\n        } else {\n            console.error(`Layer group '${group}' not found in renderer._layerGroups`)\n        }\n \n    } catch (error) {\n        console.error('添加角色时出错:', error)\n    }\n}\n```\n\n## 关键点解析\n\n图片的加载与转换：通过 fetch 方法获取图片数据，并使用 canvas 将其绘制为 Base64 格式，确保图片能被 Scratch 识别并处理。\n\n角色的创建与初始化：创建 costume 对象，包含图片的相关信息，并利用 Scratch 的内部 renderer 机制生成角色的皮肤 ID（skinId）。然后，通过创建 sprite 和 target 对象，将角色成功添加到 Scratch 的角色区。\n\n层次管理：通过遍历现有角色，确定新的角色应处于的层次顺序，确保角色在舞台上的显示效果正确。\n\n## 最终的收获\n\n解决这个问题的过程充满了挑战，但也让我更深入地理解了 Scratch 的内部机制。从图片的加载处理，到角色的生成与渲染，每一步都需要细心调试与思考。\n通过这次经验，我也更明确了在进行二次开发时，深入了解底层机制的重要性。希望这篇文章能对遇到类似问题的开发者有所帮助。\n\n![生成中](/img/scratch_custom/img-1.png)\n\n![已完成](/img/scratch_custom/img-2.png)\n\n","source":"_posts/scratch_custom_1.md","raw":"---\ntitle: 通过文生图模型在 Scratch 3 角色区生成图片\ndate: 2024-08-11\nupdated: 2024-08-11\ncategories: 创界编途·Scratch新章\nkeywords: 创界编途·Scratch新章\ntop_img: /img/scratch_custom/scratch-bg.png\ncover: /img/scratch_custom/scratch-cover.jpg\n---\n\n在进行 Scratch 3 的二次开发过程中，我遇到了一个特别棘手的问题：如何通过文生图模型生成的图片，在 Scratch 的角色区成功添加一个新的角色。看似简单的任务背后，却隐藏着不少意想不到的困难。以下是我解决这个问题的完整经历。\n\n## 遇到的问题\n\n起初，我的目标很明确——通过文本生成图片，并将该图片添加为一个新的角色到 Scratch 的角色区。然而，实际操作过程中，我遭遇了多个问题：\n\n1. **图片的处理**：将通过文生图模型生成的图片 URL 转换为 Scratch 可以识别和使用的角色数据，过程中涉及到图片的加载、数据格式的转换，以及图片与 Scratch 内部数据结构的对接，这一步的复杂程度超出了我的预期。\n\n2. **角色的创建与渲染**：在 Scratch 中，添加新角色不仅仅是将图片插入这么简单，它需要严格遵守 Scratch 的角色生成与渲染机制。我在这一步中多次遇到渲染失败的情况，角色始终无法正确显示在舞台上。\n\n3. **层次管理**：Scratch 的角色具有层次关系，如何在不影响其他角色的前提下正确设置新角色的层次顺序，也是一个必须解决的问题。\n\n## 解决方法\n\n经过多次调试与查阅文档，我逐渐理清了问题的脉络，并最终找到了有效的解决方法。以下是关键的代码片段及其背后的思路：\n\n```javascript\nasync TextGeneratedPic(args, util) {\n    const imageUrl = this.imageUrl // 通过文生图模型获取的图片url\n    await this.addNewSprite(imageUrl, util)\n}\n```\n\n图片处理与角色创建\n\n首先，我编写了 addNewSprite 方法，负责将生成的图片转换为 Scratch 可以识别的格式，并创建新角色。\n\n```javascript\nasync addNewSprite(imageUrl, util) {\n    try {\n        const response = await fetch(imageUrl)\n        const blob = await response.blob()\n        const imageBitmap = await createImageBitmap(blob)\n        const extractedContent = imageUrl.split('.png')[0]\n        const md5 = extractedContent\n\n        // 创建 canvas，将图片绘制到 canvas 上\n        const canvas = document.createElement('canvas')\n        canvas.width = imageBitmap.width\n        canvas.height = imageBitmap.height\n        const context = canvas.getContext('2d')\n        context.drawImage(imageBitmap, 0, 0)\n\n        // 将 canvas 转换为 Base64 格式\n        const pngDataUrl = canvas.toDataURL('image/png')\n        const base64Data = pngDataUrl.split(',')[1]\n\n        // 将 Base64 数据转换为二进制数据\n        const binaryString = atob(base64Data)\n        const binaryLen = binaryString.length\n        const bytes = new Uint8Array(binaryLen)\n        for (let i = 0; i < binaryLen; i++) {\n            const ascii = binaryString.charCodeAt(i)\n            bytes[i] = ascii\n        }\n\n        // 创建角色的 costume 对象\n        const costume = {\n            asset: null,\n            md5: `${md5}.png`,\n            name: this.fileName + new Date().getTime(),\n            bitmapResolution: 2,\n            rotationCenterX: imageBitmap.width / 2,\n            rotationCenterY: imageBitmap.height / 2,\n            skinId: null,\n            dataFormat: 'png'\n        }\n\n        // 处理图片资源\n        const storage = this.runtime.storage\n        const asset = storage.createAsset(\n            AssetType.ImageBitmap,\n            'png',\n            bytes,\n            md5\n        )\n        costume.asset = asset\n        costume.assetId = asset.assetId\n\n        // 渲染新角色\n        const skinId = await this.runtime.renderer.createBitmapSkin(imageBitmap, costume.bitmapResolution)\n        costume.skinId = skinId\n\n        const spriteName = this.dddabc\n        const sprite = new Sprite(null, this.runtime)\n        sprite.costumes = [costume]\n        sprite.name = spriteName + new Date().getTime()\n        sprite.sounds = []\n        sprite.variables = {}\n        sprite.lists = {}\n        sprite.broadcasts = {}\n        sprite.comments = {}\n        sprite.clones = []\n        sprite.layerOrder = 0\n\n        const blocks = new Blocks(this.runtime, sprite)\n        blocks.forceNoGlow = false\n        sprite.blocks = blocks\n\n        const target = new RenderedTarget(sprite, this.runtime)\n        target.id = uid()\n        target.blocks = blocks\n        target.runtime = this.runtime\n\n        sprite.clones.push(target)\n\n        const group = 'sprite'\n        if (this.runtime.renderer._layerGroups && this.runtime.renderer._layerGroups[group]) {\n            const drawableID = this.runtime.renderer.createDrawable(group)\n            if (drawableID === undefined) {\n                console.error('Failed to create drawable')\n                return\n            }\n\n            target.drawableID = drawableID\n            this.runtime.renderer.updateDrawableSkinId(drawableID, skinId)\n            target.setVisible(true)\n\n            let maxLayerOrder = 0\n            for (let i = 0; i < this.runtime.targets.length; i++) {\n                if (!this.runtime.targets[i].isStage && this.runtime.targets[i].sprite.layerOrder > maxLayerOrder) {\n                    maxLayerOrder = this.runtime.targets[i].sprite.layerOrder\n                }\n            }\n            target.sprite.layerOrder = maxLayerOrder + 1\n\n            this.runtime.addTarget(target)\n            this.runtime.setEditingTarget(target.id)\n\n            this.runtime.emit(\"SAY\", util.target, \"say\", '')\n            console.log('角色已成功添加')\n        } else {\n            console.error(`Layer group '${group}' not found in renderer._layerGroups`)\n        }\n \n    } catch (error) {\n        console.error('添加角色时出错:', error)\n    }\n}\n```\n\n## 关键点解析\n\n图片的加载与转换：通过 fetch 方法获取图片数据，并使用 canvas 将其绘制为 Base64 格式，确保图片能被 Scratch 识别并处理。\n\n角色的创建与初始化：创建 costume 对象，包含图片的相关信息，并利用 Scratch 的内部 renderer 机制生成角色的皮肤 ID（skinId）。然后，通过创建 sprite 和 target 对象，将角色成功添加到 Scratch 的角色区。\n\n层次管理：通过遍历现有角色，确定新的角色应处于的层次顺序，确保角色在舞台上的显示效果正确。\n\n## 最终的收获\n\n解决这个问题的过程充满了挑战，但也让我更深入地理解了 Scratch 的内部机制。从图片的加载处理，到角色的生成与渲染，每一步都需要细心调试与思考。\n通过这次经验，我也更明确了在进行二次开发时，深入了解底层机制的重要性。希望这篇文章能对遇到类似问题的开发者有所帮助。\n\n![生成中](/img/scratch_custom/img-1.png)\n\n![已完成](/img/scratch_custom/img-2.png)\n\n","slug":"scratch_custom_1","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cm0nom53h0003az7dbb843u8v","content":"<p>在进行 Scratch 3 的二次开发过程中，我遇到了一个特别棘手的问题：如何通过文生图模型生成的图片，在 Scratch 的角色区成功添加一个新的角色。看似简单的任务背后，却隐藏着不少意想不到的困难。以下是我解决这个问题的完整经历。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><p>起初，我的目标很明确——通过文本生成图片，并将该图片添加为一个新的角色到 Scratch 的角色区。然而，实际操作过程中，我遭遇了多个问题：</p>\n<ol>\n<li><p><strong>图片的处理</strong>：将通过文生图模型生成的图片 URL 转换为 Scratch 可以识别和使用的角色数据，过程中涉及到图片的加载、数据格式的转换，以及图片与 Scratch 内部数据结构的对接，这一步的复杂程度超出了我的预期。</p>\n</li>\n<li><p><strong>角色的创建与渲染</strong>：在 Scratch 中，添加新角色不仅仅是将图片插入这么简单，它需要严格遵守 Scratch 的角色生成与渲染机制。我在这一步中多次遇到渲染失败的情况，角色始终无法正确显示在舞台上。</p>\n</li>\n<li><p><strong>层次管理</strong>：Scratch 的角色具有层次关系，如何在不影响其他角色的前提下正确设置新角色的层次顺序，也是一个必须解决的问题。</p>\n</li>\n</ol>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>经过多次调试与查阅文档，我逐渐理清了问题的脉络，并最终找到了有效的解决方法。以下是关键的代码片段及其背后的思路：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title class_\">TextGeneratedPic</span>(args, util) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> imageUrl = <span class=\"variable language_\">this</span>.<span class=\"property\">imageUrl</span> <span class=\"comment\">// 通过文生图模型获取的图片url</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">addNewSprite</span>(imageUrl, util)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>图片处理与角色创建</p>\n<p>首先，我编写了 addNewSprite 方法，负责将生成的图片转换为 Scratch 可以识别的格式，并创建新角色。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">addNewSprite</span>(<span class=\"params\">imageUrl, util</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(imageUrl)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> blob = <span class=\"keyword\">await</span> response.<span class=\"title function_\">blob</span>()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> imageBitmap = <span class=\"keyword\">await</span> <span class=\"title function_\">createImageBitmap</span>(blob)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> extractedContent = imageUrl.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.png&#x27;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">        <span class=\"keyword\">const</span> md5 = extractedContent</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 创建 canvas，将图片绘制到 canvas 上</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> canvas = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;canvas&#x27;</span>)</span><br><span class=\"line\">        canvas.<span class=\"property\">width</span> = imageBitmap.<span class=\"property\">width</span></span><br><span class=\"line\">        canvas.<span class=\"property\">height</span> = imageBitmap.<span class=\"property\">height</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> context = canvas.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>)</span><br><span class=\"line\">        context.<span class=\"title function_\">drawImage</span>(imageBitmap, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 将 canvas 转换为 Base64 格式</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> pngDataUrl = canvas.<span class=\"title function_\">toDataURL</span>(<span class=\"string\">&#x27;image/png&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> base64Data = pngDataUrl.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 将 Base64 数据转换为二进制数据</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> binaryString = <span class=\"title function_\">atob</span>(base64Data)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> binaryLen = binaryString.<span class=\"property\">length</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> bytes = <span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(binaryLen)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; binaryLen; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> ascii = binaryString.<span class=\"title function_\">charCodeAt</span>(i)</span><br><span class=\"line\">            bytes[i] = ascii</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 创建角色的 costume 对象</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> costume = &#123;</span><br><span class=\"line\">            <span class=\"attr\">asset</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">md5</span>: <span class=\"string\">`<span class=\"subst\">$&#123;md5&#125;</span>.png`</span>,</span><br><span class=\"line\">            <span class=\"attr\">name</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">fileName</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>(),</span><br><span class=\"line\">            <span class=\"attr\">bitmapResolution</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">rotationCenterX</span>: imageBitmap.<span class=\"property\">width</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">rotationCenterY</span>: imageBitmap.<span class=\"property\">height</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">skinId</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">dataFormat</span>: <span class=\"string\">&#x27;png&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 处理图片资源</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> storage = <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">storage</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> asset = storage.<span class=\"title function_\">createAsset</span>(</span><br><span class=\"line\">            <span class=\"title class_\">AssetType</span>.<span class=\"property\">ImageBitmap</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;png&#x27;</span>,</span><br><span class=\"line\">            bytes,</span><br><span class=\"line\">            md5</span><br><span class=\"line\">        )</span><br><span class=\"line\">        costume.<span class=\"property\">asset</span> = asset</span><br><span class=\"line\">        costume.<span class=\"property\">assetId</span> = asset.<span class=\"property\">assetId</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 渲染新角色</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> skinId = <span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"title function_\">createBitmapSkin</span>(imageBitmap, costume.<span class=\"property\">bitmapResolution</span>)</span><br><span class=\"line\">        costume.<span class=\"property\">skinId</span> = skinId</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> spriteName = <span class=\"variable language_\">this</span>.<span class=\"property\">dddabc</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> sprite = <span class=\"keyword\">new</span> <span class=\"title class_\">Sprite</span>(<span class=\"literal\">null</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>)</span><br><span class=\"line\">        sprite.<span class=\"property\">costumes</span> = [costume]</span><br><span class=\"line\">        sprite.<span class=\"property\">name</span> = spriteName + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>()</span><br><span class=\"line\">        sprite.<span class=\"property\">sounds</span> = []</span><br><span class=\"line\">        sprite.<span class=\"property\">variables</span> = &#123;&#125;</span><br><span class=\"line\">        sprite.<span class=\"property\">lists</span> = &#123;&#125;</span><br><span class=\"line\">        sprite.<span class=\"property\">broadcasts</span> = &#123;&#125;</span><br><span class=\"line\">        sprite.<span class=\"property\">comments</span> = &#123;&#125;</span><br><span class=\"line\">        sprite.<span class=\"property\">clones</span> = []</span><br><span class=\"line\">        sprite.<span class=\"property\">layerOrder</span> = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> blocks = <span class=\"keyword\">new</span> <span class=\"title class_\">Blocks</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>, sprite)</span><br><span class=\"line\">        blocks.<span class=\"property\">forceNoGlow</span> = <span class=\"literal\">false</span></span><br><span class=\"line\">        sprite.<span class=\"property\">blocks</span> = blocks</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> target = <span class=\"keyword\">new</span> <span class=\"title class_\">RenderedTarget</span>(sprite, <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>)</span><br><span class=\"line\">        target.<span class=\"property\">id</span> = <span class=\"title function_\">uid</span>()</span><br><span class=\"line\">        target.<span class=\"property\">blocks</span> = blocks</span><br><span class=\"line\">        target.<span class=\"property\">runtime</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span></span><br><span class=\"line\"></span><br><span class=\"line\">        sprite.<span class=\"property\">clones</span>.<span class=\"title function_\">push</span>(target)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> group = <span class=\"string\">&#x27;sprite&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"property\">_layerGroups</span> &amp;&amp; <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"property\">_layerGroups</span>[group]) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> drawableID = <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"title function_\">createDrawable</span>(group)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (drawableID === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Failed to create drawable&#x27;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            target.<span class=\"property\">drawableID</span> = drawableID</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"title function_\">updateDrawableSkinId</span>(drawableID, skinId)</span><br><span class=\"line\">            target.<span class=\"title function_\">setVisible</span>(<span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> maxLayerOrder = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">targets</span>.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!<span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">targets</span>[i].<span class=\"property\">isStage</span> &amp;&amp; <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">targets</span>[i].<span class=\"property\">sprite</span>.<span class=\"property\">layerOrder</span> &gt; maxLayerOrder) &#123;</span><br><span class=\"line\">                    maxLayerOrder = <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">targets</span>[i].<span class=\"property\">sprite</span>.<span class=\"property\">layerOrder</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            target.<span class=\"property\">sprite</span>.<span class=\"property\">layerOrder</span> = maxLayerOrder + <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">addTarget</span>(target)</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">setEditingTarget</span>(target.<span class=\"property\">id</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">emit</span>(<span class=\"string\">&quot;SAY&quot;</span>, util.<span class=\"property\">target</span>, <span class=\"string\">&quot;say&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;角色已成功添加&#x27;</span>)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">`Layer group &#x27;<span class=\"subst\">$&#123;group&#125;</span>&#x27; not found in renderer._layerGroups`</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;添加角色时出错:&#x27;</span>, error)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"关键点解析\"><a href=\"#关键点解析\" class=\"headerlink\" title=\"关键点解析\"></a>关键点解析</h2><p>图片的加载与转换：通过 fetch 方法获取图片数据，并使用 canvas 将其绘制为 Base64 格式，确保图片能被 Scratch 识别并处理。</p>\n<p>角色的创建与初始化：创建 costume 对象，包含图片的相关信息，并利用 Scratch 的内部 renderer 机制生成角色的皮肤 ID（skinId）。然后，通过创建 sprite 和 target 对象，将角色成功添加到 Scratch 的角色区。</p>\n<p>层次管理：通过遍历现有角色，确定新的角色应处于的层次顺序，确保角色在舞台上的显示效果正确。</p>\n<h2 id=\"最终的收获\"><a href=\"#最终的收获\" class=\"headerlink\" title=\"最终的收获\"></a>最终的收获</h2><p>解决这个问题的过程充满了挑战，但也让我更深入地理解了 Scratch 的内部机制。从图片的加载处理，到角色的生成与渲染，每一步都需要细心调试与思考。<br>通过这次经验，我也更明确了在进行二次开发时，深入了解底层机制的重要性。希望这篇文章能对遇到类似问题的开发者有所帮助。</p>\n<p><img src=\"/img/scratch_custom/img-1.png\" alt=\"生成中\"></p>\n<p><img src=\"/img/scratch_custom/img-2.png\" alt=\"已完成\"></p>\n","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"excerpt":"","more":"<p>在进行 Scratch 3 的二次开发过程中，我遇到了一个特别棘手的问题：如何通过文生图模型生成的图片，在 Scratch 的角色区成功添加一个新的角色。看似简单的任务背后，却隐藏着不少意想不到的困难。以下是我解决这个问题的完整经历。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><p>起初，我的目标很明确——通过文本生成图片，并将该图片添加为一个新的角色到 Scratch 的角色区。然而，实际操作过程中，我遭遇了多个问题：</p>\n<ol>\n<li><p><strong>图片的处理</strong>：将通过文生图模型生成的图片 URL 转换为 Scratch 可以识别和使用的角色数据，过程中涉及到图片的加载、数据格式的转换，以及图片与 Scratch 内部数据结构的对接，这一步的复杂程度超出了我的预期。</p>\n</li>\n<li><p><strong>角色的创建与渲染</strong>：在 Scratch 中，添加新角色不仅仅是将图片插入这么简单，它需要严格遵守 Scratch 的角色生成与渲染机制。我在这一步中多次遇到渲染失败的情况，角色始终无法正确显示在舞台上。</p>\n</li>\n<li><p><strong>层次管理</strong>：Scratch 的角色具有层次关系，如何在不影响其他角色的前提下正确设置新角色的层次顺序，也是一个必须解决的问题。</p>\n</li>\n</ol>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>经过多次调试与查阅文档，我逐渐理清了问题的脉络，并最终找到了有效的解决方法。以下是关键的代码片段及其背后的思路：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title class_\">TextGeneratedPic</span>(args, util) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> imageUrl = <span class=\"variable language_\">this</span>.<span class=\"property\">imageUrl</span> <span class=\"comment\">// 通过文生图模型获取的图片url</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">addNewSprite</span>(imageUrl, util)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>图片处理与角色创建</p>\n<p>首先，我编写了 addNewSprite 方法，负责将生成的图片转换为 Scratch 可以识别的格式，并创建新角色。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">addNewSprite</span>(<span class=\"params\">imageUrl, util</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(imageUrl)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> blob = <span class=\"keyword\">await</span> response.<span class=\"title function_\">blob</span>()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> imageBitmap = <span class=\"keyword\">await</span> <span class=\"title function_\">createImageBitmap</span>(blob)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> extractedContent = imageUrl.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.png&#x27;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">        <span class=\"keyword\">const</span> md5 = extractedContent</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 创建 canvas，将图片绘制到 canvas 上</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> canvas = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;canvas&#x27;</span>)</span><br><span class=\"line\">        canvas.<span class=\"property\">width</span> = imageBitmap.<span class=\"property\">width</span></span><br><span class=\"line\">        canvas.<span class=\"property\">height</span> = imageBitmap.<span class=\"property\">height</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> context = canvas.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>)</span><br><span class=\"line\">        context.<span class=\"title function_\">drawImage</span>(imageBitmap, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 将 canvas 转换为 Base64 格式</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> pngDataUrl = canvas.<span class=\"title function_\">toDataURL</span>(<span class=\"string\">&#x27;image/png&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> base64Data = pngDataUrl.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 将 Base64 数据转换为二进制数据</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> binaryString = <span class=\"title function_\">atob</span>(base64Data)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> binaryLen = binaryString.<span class=\"property\">length</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> bytes = <span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(binaryLen)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; binaryLen; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> ascii = binaryString.<span class=\"title function_\">charCodeAt</span>(i)</span><br><span class=\"line\">            bytes[i] = ascii</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 创建角色的 costume 对象</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> costume = &#123;</span><br><span class=\"line\">            <span class=\"attr\">asset</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">md5</span>: <span class=\"string\">`<span class=\"subst\">$&#123;md5&#125;</span>.png`</span>,</span><br><span class=\"line\">            <span class=\"attr\">name</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">fileName</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>(),</span><br><span class=\"line\">            <span class=\"attr\">bitmapResolution</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">rotationCenterX</span>: imageBitmap.<span class=\"property\">width</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">rotationCenterY</span>: imageBitmap.<span class=\"property\">height</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">skinId</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">dataFormat</span>: <span class=\"string\">&#x27;png&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 处理图片资源</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> storage = <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">storage</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> asset = storage.<span class=\"title function_\">createAsset</span>(</span><br><span class=\"line\">            <span class=\"title class_\">AssetType</span>.<span class=\"property\">ImageBitmap</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;png&#x27;</span>,</span><br><span class=\"line\">            bytes,</span><br><span class=\"line\">            md5</span><br><span class=\"line\">        )</span><br><span class=\"line\">        costume.<span class=\"property\">asset</span> = asset</span><br><span class=\"line\">        costume.<span class=\"property\">assetId</span> = asset.<span class=\"property\">assetId</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 渲染新角色</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> skinId = <span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"title function_\">createBitmapSkin</span>(imageBitmap, costume.<span class=\"property\">bitmapResolution</span>)</span><br><span class=\"line\">        costume.<span class=\"property\">skinId</span> = skinId</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> spriteName = <span class=\"variable language_\">this</span>.<span class=\"property\">dddabc</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> sprite = <span class=\"keyword\">new</span> <span class=\"title class_\">Sprite</span>(<span class=\"literal\">null</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>)</span><br><span class=\"line\">        sprite.<span class=\"property\">costumes</span> = [costume]</span><br><span class=\"line\">        sprite.<span class=\"property\">name</span> = spriteName + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>()</span><br><span class=\"line\">        sprite.<span class=\"property\">sounds</span> = []</span><br><span class=\"line\">        sprite.<span class=\"property\">variables</span> = &#123;&#125;</span><br><span class=\"line\">        sprite.<span class=\"property\">lists</span> = &#123;&#125;</span><br><span class=\"line\">        sprite.<span class=\"property\">broadcasts</span> = &#123;&#125;</span><br><span class=\"line\">        sprite.<span class=\"property\">comments</span> = &#123;&#125;</span><br><span class=\"line\">        sprite.<span class=\"property\">clones</span> = []</span><br><span class=\"line\">        sprite.<span class=\"property\">layerOrder</span> = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> blocks = <span class=\"keyword\">new</span> <span class=\"title class_\">Blocks</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>, sprite)</span><br><span class=\"line\">        blocks.<span class=\"property\">forceNoGlow</span> = <span class=\"literal\">false</span></span><br><span class=\"line\">        sprite.<span class=\"property\">blocks</span> = blocks</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> target = <span class=\"keyword\">new</span> <span class=\"title class_\">RenderedTarget</span>(sprite, <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>)</span><br><span class=\"line\">        target.<span class=\"property\">id</span> = <span class=\"title function_\">uid</span>()</span><br><span class=\"line\">        target.<span class=\"property\">blocks</span> = blocks</span><br><span class=\"line\">        target.<span class=\"property\">runtime</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span></span><br><span class=\"line\"></span><br><span class=\"line\">        sprite.<span class=\"property\">clones</span>.<span class=\"title function_\">push</span>(target)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> group = <span class=\"string\">&#x27;sprite&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"property\">_layerGroups</span> &amp;&amp; <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"property\">_layerGroups</span>[group]) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> drawableID = <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"title function_\">createDrawable</span>(group)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (drawableID === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Failed to create drawable&#x27;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            target.<span class=\"property\">drawableID</span> = drawableID</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"title function_\">updateDrawableSkinId</span>(drawableID, skinId)</span><br><span class=\"line\">            target.<span class=\"title function_\">setVisible</span>(<span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> maxLayerOrder = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">targets</span>.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!<span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">targets</span>[i].<span class=\"property\">isStage</span> &amp;&amp; <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">targets</span>[i].<span class=\"property\">sprite</span>.<span class=\"property\">layerOrder</span> &gt; maxLayerOrder) &#123;</span><br><span class=\"line\">                    maxLayerOrder = <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"property\">targets</span>[i].<span class=\"property\">sprite</span>.<span class=\"property\">layerOrder</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            target.<span class=\"property\">sprite</span>.<span class=\"property\">layerOrder</span> = maxLayerOrder + <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">addTarget</span>(target)</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">setEditingTarget</span>(target.<span class=\"property\">id</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">emit</span>(<span class=\"string\">&quot;SAY&quot;</span>, util.<span class=\"property\">target</span>, <span class=\"string\">&quot;say&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;角色已成功添加&#x27;</span>)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">`Layer group &#x27;<span class=\"subst\">$&#123;group&#125;</span>&#x27; not found in renderer._layerGroups`</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;添加角色时出错:&#x27;</span>, error)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"关键点解析\"><a href=\"#关键点解析\" class=\"headerlink\" title=\"关键点解析\"></a>关键点解析</h2><p>图片的加载与转换：通过 fetch 方法获取图片数据，并使用 canvas 将其绘制为 Base64 格式，确保图片能被 Scratch 识别并处理。</p>\n<p>角色的创建与初始化：创建 costume 对象，包含图片的相关信息，并利用 Scratch 的内部 renderer 机制生成角色的皮肤 ID（skinId）。然后，通过创建 sprite 和 target 对象，将角色成功添加到 Scratch 的角色区。</p>\n<p>层次管理：通过遍历现有角色，确定新的角色应处于的层次顺序，确保角色在舞台上的显示效果正确。</p>\n<h2 id=\"最终的收获\"><a href=\"#最终的收获\" class=\"headerlink\" title=\"最终的收获\"></a>最终的收获</h2><p>解决这个问题的过程充满了挑战，但也让我更深入地理解了 Scratch 的内部机制。从图片的加载处理，到角色的生成与渲染，每一步都需要细心调试与思考。<br>通过这次经验，我也更明确了在进行二次开发时，深入了解底层机制的重要性。希望这篇文章能对遇到类似问题的开发者有所帮助。</p>\n<p><img src=\"/img/scratch_custom/img-1.png\" alt=\"生成中\"></p>\n<p><img src=\"/img/scratch_custom/img-2.png\" alt=\"已完成\"></p>\n"},{"title":"通过文生图模型在 Scratch 3 造型区生成图片","date":"2024-08-11T16:00:00.000Z","updated":"2024-08-11T16:00:00.000Z","keywords":"创界编途·Scratch新章","top_img":"/img/scratch_custom/scratch-bg.png","cover":"/img/scratch_custom/scratch-cover.jpg","_content":"\n在解决了通过文生图模型在角色区生成图片的问题之后，我接下来挑战的目标是通过同样的方式，在 Scratch 3 的造型区添加图片。由于之前已经在角色区生成图片取得了成功，这一次的任务相对容易些，但仍然有一些值得分享的细节和经验。\n\n## 遇到的问题\n\n这个任务的难度较低，主要原因是造型的添加逻辑和角色的添加非常类似。我只需要将新生成的图片作为一个造型附加到已有的角色上，而不必像之前那样去处理复杂的角色渲染和层次管理。\n\n然而，造型的添加过程中，仍然需要注意图片的格式处理，以及如何将生成的图片成功转换为 Scratch 内部识别的 `costume` 对象，并设置为当前的造型。\n\n## 解决方法\n\n我沿用了之前添加角色时的一部分代码，并根据造型的特点对其进行了调整。以下是关键的代码：\n\n```javascript\nasync TextGeneratedPic(args, util) {\n    const imageUrl = this.imageUrl\n    const target = util.target\n    await this.addCostumeToTarget(target, imageUrl, util)\n}\n```\n\n在这段代码中，TextGeneratedPic 方法会接收生成的图片 URL，并调用 addCostumeToTarget 方法将其添加到目标角色的造型列表中。\n\n## 造型的添加与设置\n\n以下是 addCostumeToTarget 方法的详细代码：\n\n```javascript\nasync addCostumeToTarget(target, imageUrl, util) {\n    try {\n        const response = await fetch(imageUrl)\n        const blob = await response.blob()\n        const imageBitmap = await createImageBitmap(blob)\n        const extractedContent = this.imageUrl.split('.png')[0]\n\n        const md5 = extractedContent\n\n        const canvas = document.createElement('canvas')\n        canvas.width = imageBitmap.width\n        canvas.height = imageBitmap.height\n        const context = canvas.getContext('2d')\n        context.drawImage(imageBitmap, 0, 0)\n\n        const pngDataUrl = canvas.toDataURL('image/png')\n        const base64Data = pngDataUrl.split(',')[1]\n\n        const binaryString = atob(base64Data)\n        const binaryLen = binaryString.length\n        const bytes = new Uint8Array(binaryLen)\n        for (let i = 0; i < binaryLen; i++) {\n            const ascii = binaryString.charCodeAt(i)\n            bytes[i] = ascii\n        }\n\n        const costume = {\n            asset: null,\n            md5: `${md5}.png`,\n            name: this.fileName + new Date().getTime(),\n            bitmapResolution: 2,\n            rotationCenterX: imageBitmap.width / 2,\n            rotationCenterY: imageBitmap.height / 2,\n            skinId: null,\n            dataFormat: 'png'\n        }\n\n        // 存储图片资源并创建皮肤\n        const storage = target.runtime.storage\n        const asset = storage.createAsset(\n            AssetType.ImageBitmap,\n            'png',\n            bytes,\n            md5\n        )\n\n        costume.asset = asset\n        costume.assetId = asset.assetId\n\n        const skinId = await target.runtime.renderer.createBitmapSkin(imageBitmap, costume.bitmapResolution)\n        costume.skinId = skinId\n\n        // 添加造型并设置为当前造型\n        target.sprite.costumes.push(costume)\n        target.setCostume(target.sprite.costumes.length - 1)\n        this.runtime.emit(\"SAY\", util.target, \"say\", '')\n        console.log('造型已成功添加并设置为当前造型')\n    } catch (error) {\n        console.error('添加造型时出错:', error)\n    }\n}\n```\n\n## 关键步骤解析\n\n图片的加载与转换：首先，使用 fetch 方法从 imageUrl 中获取图片，并通过 createImageBitmap 将图片转换为 imageBitmap 对象。然后，通过 canvas 将图片绘制并转化为 Base64 数据。\n\n创建造型对象：接下来，将图片数据转换为 costume 对象。costume 包含了图片的 MD5、名称、分辨率等信息，这与角色区的图片处理逻辑类似。\n\n添加与设置当前造型：将新的造型添加到目标角色的 costumes 列表中，并通过 setCostume 方法将其设置为当前造型。\n\n## 收获与总结\n\n相比之前在角色区生成图片的任务，这次在造型区生成图片要容易许多，主要的工作还是在图片的处理和造型的添加上。经过之前的经验积累，我在这次任务中遇到的问题较少，代码的整体思路也相对清晰。\n\n![生成中](/img/scratch_custom/img-3.png)\n\n![已完成](/img/scratch_custom/img-4.png)","source":"_posts/scratch_custom_2.md","raw":"---\ntitle: 通过文生图模型在 Scratch 3 造型区生成图片\ndate: 2024-08-12\nupdated: 2024-08-12\ncategories: 创界编途·Scratch新章\nkeywords: 创界编途·Scratch新章\ntop_img: /img/scratch_custom/scratch-bg.png\ncover: /img/scratch_custom/scratch-cover.jpg\n---\n\n在解决了通过文生图模型在角色区生成图片的问题之后，我接下来挑战的目标是通过同样的方式，在 Scratch 3 的造型区添加图片。由于之前已经在角色区生成图片取得了成功，这一次的任务相对容易些，但仍然有一些值得分享的细节和经验。\n\n## 遇到的问题\n\n这个任务的难度较低，主要原因是造型的添加逻辑和角色的添加非常类似。我只需要将新生成的图片作为一个造型附加到已有的角色上，而不必像之前那样去处理复杂的角色渲染和层次管理。\n\n然而，造型的添加过程中，仍然需要注意图片的格式处理，以及如何将生成的图片成功转换为 Scratch 内部识别的 `costume` 对象，并设置为当前的造型。\n\n## 解决方法\n\n我沿用了之前添加角色时的一部分代码，并根据造型的特点对其进行了调整。以下是关键的代码：\n\n```javascript\nasync TextGeneratedPic(args, util) {\n    const imageUrl = this.imageUrl\n    const target = util.target\n    await this.addCostumeToTarget(target, imageUrl, util)\n}\n```\n\n在这段代码中，TextGeneratedPic 方法会接收生成的图片 URL，并调用 addCostumeToTarget 方法将其添加到目标角色的造型列表中。\n\n## 造型的添加与设置\n\n以下是 addCostumeToTarget 方法的详细代码：\n\n```javascript\nasync addCostumeToTarget(target, imageUrl, util) {\n    try {\n        const response = await fetch(imageUrl)\n        const blob = await response.blob()\n        const imageBitmap = await createImageBitmap(blob)\n        const extractedContent = this.imageUrl.split('.png')[0]\n\n        const md5 = extractedContent\n\n        const canvas = document.createElement('canvas')\n        canvas.width = imageBitmap.width\n        canvas.height = imageBitmap.height\n        const context = canvas.getContext('2d')\n        context.drawImage(imageBitmap, 0, 0)\n\n        const pngDataUrl = canvas.toDataURL('image/png')\n        const base64Data = pngDataUrl.split(',')[1]\n\n        const binaryString = atob(base64Data)\n        const binaryLen = binaryString.length\n        const bytes = new Uint8Array(binaryLen)\n        for (let i = 0; i < binaryLen; i++) {\n            const ascii = binaryString.charCodeAt(i)\n            bytes[i] = ascii\n        }\n\n        const costume = {\n            asset: null,\n            md5: `${md5}.png`,\n            name: this.fileName + new Date().getTime(),\n            bitmapResolution: 2,\n            rotationCenterX: imageBitmap.width / 2,\n            rotationCenterY: imageBitmap.height / 2,\n            skinId: null,\n            dataFormat: 'png'\n        }\n\n        // 存储图片资源并创建皮肤\n        const storage = target.runtime.storage\n        const asset = storage.createAsset(\n            AssetType.ImageBitmap,\n            'png',\n            bytes,\n            md5\n        )\n\n        costume.asset = asset\n        costume.assetId = asset.assetId\n\n        const skinId = await target.runtime.renderer.createBitmapSkin(imageBitmap, costume.bitmapResolution)\n        costume.skinId = skinId\n\n        // 添加造型并设置为当前造型\n        target.sprite.costumes.push(costume)\n        target.setCostume(target.sprite.costumes.length - 1)\n        this.runtime.emit(\"SAY\", util.target, \"say\", '')\n        console.log('造型已成功添加并设置为当前造型')\n    } catch (error) {\n        console.error('添加造型时出错:', error)\n    }\n}\n```\n\n## 关键步骤解析\n\n图片的加载与转换：首先，使用 fetch 方法从 imageUrl 中获取图片，并通过 createImageBitmap 将图片转换为 imageBitmap 对象。然后，通过 canvas 将图片绘制并转化为 Base64 数据。\n\n创建造型对象：接下来，将图片数据转换为 costume 对象。costume 包含了图片的 MD5、名称、分辨率等信息，这与角色区的图片处理逻辑类似。\n\n添加与设置当前造型：将新的造型添加到目标角色的 costumes 列表中，并通过 setCostume 方法将其设置为当前造型。\n\n## 收获与总结\n\n相比之前在角色区生成图片的任务，这次在造型区生成图片要容易许多，主要的工作还是在图片的处理和造型的添加上。经过之前的经验积累，我在这次任务中遇到的问题较少，代码的整体思路也相对清晰。\n\n![生成中](/img/scratch_custom/img-3.png)\n\n![已完成](/img/scratch_custom/img-4.png)","slug":"scratch_custom_2","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cm0nom53j0006az7dfft6fq9u","content":"<p>在解决了通过文生图模型在角色区生成图片的问题之后，我接下来挑战的目标是通过同样的方式，在 Scratch 3 的造型区添加图片。由于之前已经在角色区生成图片取得了成功，这一次的任务相对容易些，但仍然有一些值得分享的细节和经验。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><p>这个任务的难度较低，主要原因是造型的添加逻辑和角色的添加非常类似。我只需要将新生成的图片作为一个造型附加到已有的角色上，而不必像之前那样去处理复杂的角色渲染和层次管理。</p>\n<p>然而，造型的添加过程中，仍然需要注意图片的格式处理，以及如何将生成的图片成功转换为 Scratch 内部识别的 <code>costume</code> 对象，并设置为当前的造型。</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>我沿用了之前添加角色时的一部分代码，并根据造型的特点对其进行了调整。以下是关键的代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title class_\">TextGeneratedPic</span>(args, util) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> imageUrl = <span class=\"variable language_\">this</span>.<span class=\"property\">imageUrl</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> target = util.<span class=\"property\">target</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">addCostumeToTarget</span>(target, imageUrl, util)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这段代码中，TextGeneratedPic 方法会接收生成的图片 URL，并调用 addCostumeToTarget 方法将其添加到目标角色的造型列表中。</p>\n<h2 id=\"造型的添加与设置\"><a href=\"#造型的添加与设置\" class=\"headerlink\" title=\"造型的添加与设置\"></a>造型的添加与设置</h2><p>以下是 addCostumeToTarget 方法的详细代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">addCostumeToTarget</span>(<span class=\"params\">target, imageUrl, util</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(imageUrl)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> blob = <span class=\"keyword\">await</span> response.<span class=\"title function_\">blob</span>()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> imageBitmap = <span class=\"keyword\">await</span> <span class=\"title function_\">createImageBitmap</span>(blob)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> extractedContent = <span class=\"variable language_\">this</span>.<span class=\"property\">imageUrl</span>.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.png&#x27;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> md5 = extractedContent</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> canvas = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;canvas&#x27;</span>)</span><br><span class=\"line\">        canvas.<span class=\"property\">width</span> = imageBitmap.<span class=\"property\">width</span></span><br><span class=\"line\">        canvas.<span class=\"property\">height</span> = imageBitmap.<span class=\"property\">height</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> context = canvas.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>)</span><br><span class=\"line\">        context.<span class=\"title function_\">drawImage</span>(imageBitmap, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> pngDataUrl = canvas.<span class=\"title function_\">toDataURL</span>(<span class=\"string\">&#x27;image/png&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> base64Data = pngDataUrl.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> binaryString = <span class=\"title function_\">atob</span>(base64Data)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> binaryLen = binaryString.<span class=\"property\">length</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> bytes = <span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(binaryLen)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; binaryLen; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> ascii = binaryString.<span class=\"title function_\">charCodeAt</span>(i)</span><br><span class=\"line\">            bytes[i] = ascii</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> costume = &#123;</span><br><span class=\"line\">            <span class=\"attr\">asset</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">md5</span>: <span class=\"string\">`<span class=\"subst\">$&#123;md5&#125;</span>.png`</span>,</span><br><span class=\"line\">            <span class=\"attr\">name</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">fileName</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>(),</span><br><span class=\"line\">            <span class=\"attr\">bitmapResolution</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">rotationCenterX</span>: imageBitmap.<span class=\"property\">width</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">rotationCenterY</span>: imageBitmap.<span class=\"property\">height</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">skinId</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">dataFormat</span>: <span class=\"string\">&#x27;png&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 存储图片资源并创建皮肤</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> storage = target.<span class=\"property\">runtime</span>.<span class=\"property\">storage</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> asset = storage.<span class=\"title function_\">createAsset</span>(</span><br><span class=\"line\">            <span class=\"title class_\">AssetType</span>.<span class=\"property\">ImageBitmap</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;png&#x27;</span>,</span><br><span class=\"line\">            bytes,</span><br><span class=\"line\">            md5</span><br><span class=\"line\">        )</span><br><span class=\"line\"></span><br><span class=\"line\">        costume.<span class=\"property\">asset</span> = asset</span><br><span class=\"line\">        costume.<span class=\"property\">assetId</span> = asset.<span class=\"property\">assetId</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> skinId = <span class=\"keyword\">await</span> target.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"title function_\">createBitmapSkin</span>(imageBitmap, costume.<span class=\"property\">bitmapResolution</span>)</span><br><span class=\"line\">        costume.<span class=\"property\">skinId</span> = skinId</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 添加造型并设置为当前造型</span></span><br><span class=\"line\">        target.<span class=\"property\">sprite</span>.<span class=\"property\">costumes</span>.<span class=\"title function_\">push</span>(costume)</span><br><span class=\"line\">        target.<span class=\"title function_\">setCostume</span>(target.<span class=\"property\">sprite</span>.<span class=\"property\">costumes</span>.<span class=\"property\">length</span> - <span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">emit</span>(<span class=\"string\">&quot;SAY&quot;</span>, util.<span class=\"property\">target</span>, <span class=\"string\">&quot;say&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;造型已成功添加并设置为当前造型&#x27;</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;添加造型时出错:&#x27;</span>, error)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"关键步骤解析\"><a href=\"#关键步骤解析\" class=\"headerlink\" title=\"关键步骤解析\"></a>关键步骤解析</h2><p>图片的加载与转换：首先，使用 fetch 方法从 imageUrl 中获取图片，并通过 createImageBitmap 将图片转换为 imageBitmap 对象。然后，通过 canvas 将图片绘制并转化为 Base64 数据。</p>\n<p>创建造型对象：接下来，将图片数据转换为 costume 对象。costume 包含了图片的 MD5、名称、分辨率等信息，这与角色区的图片处理逻辑类似。</p>\n<p>添加与设置当前造型：将新的造型添加到目标角色的 costumes 列表中，并通过 setCostume 方法将其设置为当前造型。</p>\n<h2 id=\"收获与总结\"><a href=\"#收获与总结\" class=\"headerlink\" title=\"收获与总结\"></a>收获与总结</h2><p>相比之前在角色区生成图片的任务，这次在造型区生成图片要容易许多，主要的工作还是在图片的处理和造型的添加上。经过之前的经验积累，我在这次任务中遇到的问题较少，代码的整体思路也相对清晰。</p>\n<p><img src=\"/img/scratch_custom/img-3.png\" alt=\"生成中\"></p>\n<p><img src=\"/img/scratch_custom/img-4.png\" alt=\"已完成\"></p>\n","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"excerpt":"","more":"<p>在解决了通过文生图模型在角色区生成图片的问题之后，我接下来挑战的目标是通过同样的方式，在 Scratch 3 的造型区添加图片。由于之前已经在角色区生成图片取得了成功，这一次的任务相对容易些，但仍然有一些值得分享的细节和经验。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><p>这个任务的难度较低，主要原因是造型的添加逻辑和角色的添加非常类似。我只需要将新生成的图片作为一个造型附加到已有的角色上，而不必像之前那样去处理复杂的角色渲染和层次管理。</p>\n<p>然而，造型的添加过程中，仍然需要注意图片的格式处理，以及如何将生成的图片成功转换为 Scratch 内部识别的 <code>costume</code> 对象，并设置为当前的造型。</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>我沿用了之前添加角色时的一部分代码，并根据造型的特点对其进行了调整。以下是关键的代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title class_\">TextGeneratedPic</span>(args, util) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> imageUrl = <span class=\"variable language_\">this</span>.<span class=\"property\">imageUrl</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> target = util.<span class=\"property\">target</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">addCostumeToTarget</span>(target, imageUrl, util)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这段代码中，TextGeneratedPic 方法会接收生成的图片 URL，并调用 addCostumeToTarget 方法将其添加到目标角色的造型列表中。</p>\n<h2 id=\"造型的添加与设置\"><a href=\"#造型的添加与设置\" class=\"headerlink\" title=\"造型的添加与设置\"></a>造型的添加与设置</h2><p>以下是 addCostumeToTarget 方法的详细代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">addCostumeToTarget</span>(<span class=\"params\">target, imageUrl, util</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(imageUrl)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> blob = <span class=\"keyword\">await</span> response.<span class=\"title function_\">blob</span>()</span><br><span class=\"line\">        <span class=\"keyword\">const</span> imageBitmap = <span class=\"keyword\">await</span> <span class=\"title function_\">createImageBitmap</span>(blob)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> extractedContent = <span class=\"variable language_\">this</span>.<span class=\"property\">imageUrl</span>.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.png&#x27;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> md5 = extractedContent</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> canvas = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;canvas&#x27;</span>)</span><br><span class=\"line\">        canvas.<span class=\"property\">width</span> = imageBitmap.<span class=\"property\">width</span></span><br><span class=\"line\">        canvas.<span class=\"property\">height</span> = imageBitmap.<span class=\"property\">height</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> context = canvas.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>)</span><br><span class=\"line\">        context.<span class=\"title function_\">drawImage</span>(imageBitmap, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> pngDataUrl = canvas.<span class=\"title function_\">toDataURL</span>(<span class=\"string\">&#x27;image/png&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> base64Data = pngDataUrl.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> binaryString = <span class=\"title function_\">atob</span>(base64Data)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> binaryLen = binaryString.<span class=\"property\">length</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> bytes = <span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(binaryLen)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; binaryLen; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> ascii = binaryString.<span class=\"title function_\">charCodeAt</span>(i)</span><br><span class=\"line\">            bytes[i] = ascii</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> costume = &#123;</span><br><span class=\"line\">            <span class=\"attr\">asset</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">md5</span>: <span class=\"string\">`<span class=\"subst\">$&#123;md5&#125;</span>.png`</span>,</span><br><span class=\"line\">            <span class=\"attr\">name</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">fileName</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>(),</span><br><span class=\"line\">            <span class=\"attr\">bitmapResolution</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">rotationCenterX</span>: imageBitmap.<span class=\"property\">width</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">rotationCenterY</span>: imageBitmap.<span class=\"property\">height</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">            <span class=\"attr\">skinId</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">dataFormat</span>: <span class=\"string\">&#x27;png&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 存储图片资源并创建皮肤</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> storage = target.<span class=\"property\">runtime</span>.<span class=\"property\">storage</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> asset = storage.<span class=\"title function_\">createAsset</span>(</span><br><span class=\"line\">            <span class=\"title class_\">AssetType</span>.<span class=\"property\">ImageBitmap</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;png&#x27;</span>,</span><br><span class=\"line\">            bytes,</span><br><span class=\"line\">            md5</span><br><span class=\"line\">        )</span><br><span class=\"line\"></span><br><span class=\"line\">        costume.<span class=\"property\">asset</span> = asset</span><br><span class=\"line\">        costume.<span class=\"property\">assetId</span> = asset.<span class=\"property\">assetId</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> skinId = <span class=\"keyword\">await</span> target.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"title function_\">createBitmapSkin</span>(imageBitmap, costume.<span class=\"property\">bitmapResolution</span>)</span><br><span class=\"line\">        costume.<span class=\"property\">skinId</span> = skinId</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 添加造型并设置为当前造型</span></span><br><span class=\"line\">        target.<span class=\"property\">sprite</span>.<span class=\"property\">costumes</span>.<span class=\"title function_\">push</span>(costume)</span><br><span class=\"line\">        target.<span class=\"title function_\">setCostume</span>(target.<span class=\"property\">sprite</span>.<span class=\"property\">costumes</span>.<span class=\"property\">length</span> - <span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">emit</span>(<span class=\"string\">&quot;SAY&quot;</span>, util.<span class=\"property\">target</span>, <span class=\"string\">&quot;say&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;造型已成功添加并设置为当前造型&#x27;</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;添加造型时出错:&#x27;</span>, error)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"关键步骤解析\"><a href=\"#关键步骤解析\" class=\"headerlink\" title=\"关键步骤解析\"></a>关键步骤解析</h2><p>图片的加载与转换：首先，使用 fetch 方法从 imageUrl 中获取图片，并通过 createImageBitmap 将图片转换为 imageBitmap 对象。然后，通过 canvas 将图片绘制并转化为 Base64 数据。</p>\n<p>创建造型对象：接下来，将图片数据转换为 costume 对象。costume 包含了图片的 MD5、名称、分辨率等信息，这与角色区的图片处理逻辑类似。</p>\n<p>添加与设置当前造型：将新的造型添加到目标角色的 costumes 列表中，并通过 setCostume 方法将其设置为当前造型。</p>\n<h2 id=\"收获与总结\"><a href=\"#收获与总结\" class=\"headerlink\" title=\"收获与总结\"></a>收获与总结</h2><p>相比之前在角色区生成图片的任务，这次在造型区生成图片要容易许多，主要的工作还是在图片的处理和造型的添加上。经过之前的经验积累，我在这次任务中遇到的问题较少，代码的整体思路也相对清晰。</p>\n<p><img src=\"/img/scratch_custom/img-3.png\" alt=\"生成中\"></p>\n<p><img src=\"/img/scratch_custom/img-4.png\" alt=\"已完成\"></p>\n"},{"title":"通过文生图模型在 Scratch 3 背景区生成图片","date":"2024-08-14T16:00:00.000Z","updated":"2024-08-14T16:00:00.000Z","keywords":"创界编途·Scratch新章","top_img":"/img/scratch_custom/scratch-bg.png","cover":"/img/scratch_custom/scratch-cover.jpg","_content":"\n经过在角色区和造型区成功生成图片的历程之后，最后的任务就是在背景区通过文生图模型生成图片了。这次任务相对来说也是最简单的一步，因为它和之前的逻辑非常相似，只是在 Scratch 3 的背景区操作图片。\n\n## 遇到的问题\n\n在实现背景区生成图片时，我已经有了之前的角色和造型区开发的经验，因此这次遇到的挑战并不多。主要需要注意的是，背景的处理和造型类似，但需要确保它被设置为舞台的当前背景。\n\n## 解决方法\n\n这里同样使用了 `TextGeneratedPic` 方法来处理图片的生成。我们通过文生图模型获取到的图片 URL，然后调用 `addBackdropToStage` 方法将该图片设置为背景。\n\n### 关键代码\n\n```javascript\nasync TextGeneratedPic(args, util) {\n    const imageUrl = this.imageUrl\n    const stage = this.runtime.getTargetForStage()\n    await this.addBackdropToStage(stage, imageUrl, util)\n}\n```\n\n这段代码的作用是获取舞台对象 stage，并将图片 URL 传递给 addBackdropToStage 方法，以完成背景的设置。\n\n## 背景的处理与添加\n\n```javascript\nasync addBackdropToStage(stage, imageUrl, util) {\n    try {\n      const response = await fetch(imageUrl)\n      const blob = await response.blob()\n      const imageBitmap = await createImageBitmap(blob)\n      const extractedContent = this.imageUrl.split('.png')[0]\n\n      const md5 = extractedContent\n\n      const canvas = document.createElement('canvas')\n      canvas.width = imageBitmap.width\n      canvas.height = imageBitmap.height\n      const context = canvas.getContext('2d')\n      context.drawImage(imageBitmap, 0, 0)\n\n      const pngDataUrl = canvas.toDataURL('image/png')\n      const base64Data = pngDataUrl.split(',')[1]\n\n      const binaryString = atob(base64Data)\n      const binaryLen = binaryString.length\n      const bytes = new Uint8Array(binaryLen)\n      for (let i = 0; i < binaryLen; i++) {\n        const ascii = binaryString.charCodeAt(i)\n        bytes[i] = ascii\n      }\n\n      const backdrop = {\n        asset: null,\n        md5: `${md5}.png`,\n        name: this.fileName + new Date().getTime(),\n        bitmapResolution: 2,\n        rotationCenterX: imageBitmap.width / 2,\n        rotationCenterY: imageBitmap.height / 2,\n        skinId: null,\n        dataFormat: 'png'\n      }\n\n      const storage = stage.runtime.storage\n      const asset = storage.createAsset(\n        AssetType.ImageBitmap,\n        'png',\n        bytes,\n        md5\n      )\n\n      backdrop.asset = asset\n      backdrop.assetId = asset.assetId\n\n      const skinId = await stage.runtime.renderer.createBitmapSkin(imageBitmap, backdrop.bitmapResolution)\n      backdrop.skinId = skinId\n\n      console.log(stage.sprite, 'stage.sprite')\n\n      stage.sprite.costumes.push(backdrop)\n      stage.setCostume(stage.sprite.costumes.length - 1)\n      this.runtime.emit(\"SAY\", util.target, \"say\", '')\n      console.log('背景已成功添加并设置为当前背景')\n    } catch (error) {\n      console.error('添加背景时出错:', error)\n    }\n}\n```\n\n## 代码解析\n图片的加载与处理：与之前处理角色和造型时类似，我们通过 fetch 从 imageUrl 获取图片，并将其转换为 imageBitmap。通过 canvas 将图片绘制为 Base64，接着将 Base64 数据解析为二进制数据，构建背景的 backdrop 对象。\n\n背景对象的创建：backdrop 对象包含了图片的 MD5 值、名称、分辨率等信息，并通过 Scratch 的存储机制创建了对应的图片资源 asset。\n\n背景的设置：最终将背景对象添加到舞台的 costumes 列表中，并设置为当前背景。为了确保背景正确渲染，还调用了 setCostume 方法。\n\n## 经验与收获\n与之前在角色区和造型区生成图片相比，在背景区生成图片是整个任务的最后一步，也是最简单的一步。通过前面的开发经历，我对 Scratch 的渲染机制有了更深入的理解。在背景的设置过程中，主要工作依然是处理图片的格式，并确保它能够正确显示在舞台上。\n\n这次开发也标志着我在通过文生图模型生成图片任务上的全部完成。从角色区、造型区到背景区，我成功实现了在 Scratch 3 中通过文生图生成的图片动态添加的功能。\n\n![生成中](/img/scratch_custom/img-5.png)\n\n![已完成](/img/scratch_custom/img-6.png)","source":"_posts/scratch_custom_3.md","raw":"---\ntitle: 通过文生图模型在 Scratch 3 背景区生成图片\ndate: 2024-08-15\nupdated: 2024-08-15\ncategories: 创界编途·Scratch新章\nkeywords: 创界编途·Scratch新章\ntop_img: /img/scratch_custom/scratch-bg.png\ncover: /img/scratch_custom/scratch-cover.jpg\n---\n\n经过在角色区和造型区成功生成图片的历程之后，最后的任务就是在背景区通过文生图模型生成图片了。这次任务相对来说也是最简单的一步，因为它和之前的逻辑非常相似，只是在 Scratch 3 的背景区操作图片。\n\n## 遇到的问题\n\n在实现背景区生成图片时，我已经有了之前的角色和造型区开发的经验，因此这次遇到的挑战并不多。主要需要注意的是，背景的处理和造型类似，但需要确保它被设置为舞台的当前背景。\n\n## 解决方法\n\n这里同样使用了 `TextGeneratedPic` 方法来处理图片的生成。我们通过文生图模型获取到的图片 URL，然后调用 `addBackdropToStage` 方法将该图片设置为背景。\n\n### 关键代码\n\n```javascript\nasync TextGeneratedPic(args, util) {\n    const imageUrl = this.imageUrl\n    const stage = this.runtime.getTargetForStage()\n    await this.addBackdropToStage(stage, imageUrl, util)\n}\n```\n\n这段代码的作用是获取舞台对象 stage，并将图片 URL 传递给 addBackdropToStage 方法，以完成背景的设置。\n\n## 背景的处理与添加\n\n```javascript\nasync addBackdropToStage(stage, imageUrl, util) {\n    try {\n      const response = await fetch(imageUrl)\n      const blob = await response.blob()\n      const imageBitmap = await createImageBitmap(blob)\n      const extractedContent = this.imageUrl.split('.png')[0]\n\n      const md5 = extractedContent\n\n      const canvas = document.createElement('canvas')\n      canvas.width = imageBitmap.width\n      canvas.height = imageBitmap.height\n      const context = canvas.getContext('2d')\n      context.drawImage(imageBitmap, 0, 0)\n\n      const pngDataUrl = canvas.toDataURL('image/png')\n      const base64Data = pngDataUrl.split(',')[1]\n\n      const binaryString = atob(base64Data)\n      const binaryLen = binaryString.length\n      const bytes = new Uint8Array(binaryLen)\n      for (let i = 0; i < binaryLen; i++) {\n        const ascii = binaryString.charCodeAt(i)\n        bytes[i] = ascii\n      }\n\n      const backdrop = {\n        asset: null,\n        md5: `${md5}.png`,\n        name: this.fileName + new Date().getTime(),\n        bitmapResolution: 2,\n        rotationCenterX: imageBitmap.width / 2,\n        rotationCenterY: imageBitmap.height / 2,\n        skinId: null,\n        dataFormat: 'png'\n      }\n\n      const storage = stage.runtime.storage\n      const asset = storage.createAsset(\n        AssetType.ImageBitmap,\n        'png',\n        bytes,\n        md5\n      )\n\n      backdrop.asset = asset\n      backdrop.assetId = asset.assetId\n\n      const skinId = await stage.runtime.renderer.createBitmapSkin(imageBitmap, backdrop.bitmapResolution)\n      backdrop.skinId = skinId\n\n      console.log(stage.sprite, 'stage.sprite')\n\n      stage.sprite.costumes.push(backdrop)\n      stage.setCostume(stage.sprite.costumes.length - 1)\n      this.runtime.emit(\"SAY\", util.target, \"say\", '')\n      console.log('背景已成功添加并设置为当前背景')\n    } catch (error) {\n      console.error('添加背景时出错:', error)\n    }\n}\n```\n\n## 代码解析\n图片的加载与处理：与之前处理角色和造型时类似，我们通过 fetch 从 imageUrl 获取图片，并将其转换为 imageBitmap。通过 canvas 将图片绘制为 Base64，接着将 Base64 数据解析为二进制数据，构建背景的 backdrop 对象。\n\n背景对象的创建：backdrop 对象包含了图片的 MD5 值、名称、分辨率等信息，并通过 Scratch 的存储机制创建了对应的图片资源 asset。\n\n背景的设置：最终将背景对象添加到舞台的 costumes 列表中，并设置为当前背景。为了确保背景正确渲染，还调用了 setCostume 方法。\n\n## 经验与收获\n与之前在角色区和造型区生成图片相比，在背景区生成图片是整个任务的最后一步，也是最简单的一步。通过前面的开发经历，我对 Scratch 的渲染机制有了更深入的理解。在背景的设置过程中，主要工作依然是处理图片的格式，并确保它能够正确显示在舞台上。\n\n这次开发也标志着我在通过文生图模型生成图片任务上的全部完成。从角色区、造型区到背景区，我成功实现了在 Scratch 3 中通过文生图生成的图片动态添加的功能。\n\n![生成中](/img/scratch_custom/img-5.png)\n\n![已完成](/img/scratch_custom/img-6.png)","slug":"scratch_custom_3","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cm0nom53v000jaz7d0t8ldqkh","content":"<p>经过在角色区和造型区成功生成图片的历程之后，最后的任务就是在背景区通过文生图模型生成图片了。这次任务相对来说也是最简单的一步，因为它和之前的逻辑非常相似，只是在 Scratch 3 的背景区操作图片。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><p>在实现背景区生成图片时，我已经有了之前的角色和造型区开发的经验，因此这次遇到的挑战并不多。主要需要注意的是，背景的处理和造型类似，但需要确保它被设置为舞台的当前背景。</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>这里同样使用了 <code>TextGeneratedPic</code> 方法来处理图片的生成。我们通过文生图模型获取到的图片 URL，然后调用 <code>addBackdropToStage</code> 方法将该图片设置为背景。</p>\n<h3 id=\"关键代码\"><a href=\"#关键代码\" class=\"headerlink\" title=\"关键代码\"></a>关键代码</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title class_\">TextGeneratedPic</span>(args, util) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> imageUrl = <span class=\"variable language_\">this</span>.<span class=\"property\">imageUrl</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> stage = <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">getTargetForStage</span>()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">addBackdropToStage</span>(stage, imageUrl, util)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这段代码的作用是获取舞台对象 stage，并将图片 URL 传递给 addBackdropToStage 方法，以完成背景的设置。</p>\n<h2 id=\"背景的处理与添加\"><a href=\"#背景的处理与添加\" class=\"headerlink\" title=\"背景的处理与添加\"></a>背景的处理与添加</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">addBackdropToStage</span>(<span class=\"params\">stage, imageUrl, util</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(imageUrl)</span><br><span class=\"line\">      <span class=\"keyword\">const</span> blob = <span class=\"keyword\">await</span> response.<span class=\"title function_\">blob</span>()</span><br><span class=\"line\">      <span class=\"keyword\">const</span> imageBitmap = <span class=\"keyword\">await</span> <span class=\"title function_\">createImageBitmap</span>(blob)</span><br><span class=\"line\">      <span class=\"keyword\">const</span> extractedContent = <span class=\"variable language_\">this</span>.<span class=\"property\">imageUrl</span>.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.png&#x27;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> md5 = extractedContent</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> canvas = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;canvas&#x27;</span>)</span><br><span class=\"line\">      canvas.<span class=\"property\">width</span> = imageBitmap.<span class=\"property\">width</span></span><br><span class=\"line\">      canvas.<span class=\"property\">height</span> = imageBitmap.<span class=\"property\">height</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> context = canvas.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>)</span><br><span class=\"line\">      context.<span class=\"title function_\">drawImage</span>(imageBitmap, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> pngDataUrl = canvas.<span class=\"title function_\">toDataURL</span>(<span class=\"string\">&#x27;image/png&#x27;</span>)</span><br><span class=\"line\">      <span class=\"keyword\">const</span> base64Data = pngDataUrl.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> binaryString = <span class=\"title function_\">atob</span>(base64Data)</span><br><span class=\"line\">      <span class=\"keyword\">const</span> binaryLen = binaryString.<span class=\"property\">length</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> bytes = <span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(binaryLen)</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; binaryLen; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> ascii = binaryString.<span class=\"title function_\">charCodeAt</span>(i)</span><br><span class=\"line\">        bytes[i] = ascii</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> backdrop = &#123;</span><br><span class=\"line\">        <span class=\"attr\">asset</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">        <span class=\"attr\">md5</span>: <span class=\"string\">`<span class=\"subst\">$&#123;md5&#125;</span>.png`</span>,</span><br><span class=\"line\">        <span class=\"attr\">name</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">fileName</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>(),</span><br><span class=\"line\">        <span class=\"attr\">bitmapResolution</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">        <span class=\"attr\">rotationCenterX</span>: imageBitmap.<span class=\"property\">width</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">        <span class=\"attr\">rotationCenterY</span>: imageBitmap.<span class=\"property\">height</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">        <span class=\"attr\">skinId</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">        <span class=\"attr\">dataFormat</span>: <span class=\"string\">&#x27;png&#x27;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> storage = stage.<span class=\"property\">runtime</span>.<span class=\"property\">storage</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> asset = storage.<span class=\"title function_\">createAsset</span>(</span><br><span class=\"line\">        <span class=\"title class_\">AssetType</span>.<span class=\"property\">ImageBitmap</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;png&#x27;</span>,</span><br><span class=\"line\">        bytes,</span><br><span class=\"line\">        md5</span><br><span class=\"line\">      )</span><br><span class=\"line\"></span><br><span class=\"line\">      backdrop.<span class=\"property\">asset</span> = asset</span><br><span class=\"line\">      backdrop.<span class=\"property\">assetId</span> = asset.<span class=\"property\">assetId</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> skinId = <span class=\"keyword\">await</span> stage.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"title function_\">createBitmapSkin</span>(imageBitmap, backdrop.<span class=\"property\">bitmapResolution</span>)</span><br><span class=\"line\">      backdrop.<span class=\"property\">skinId</span> = skinId</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(stage.<span class=\"property\">sprite</span>, <span class=\"string\">&#x27;stage.sprite&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">      stage.<span class=\"property\">sprite</span>.<span class=\"property\">costumes</span>.<span class=\"title function_\">push</span>(backdrop)</span><br><span class=\"line\">      stage.<span class=\"title function_\">setCostume</span>(stage.<span class=\"property\">sprite</span>.<span class=\"property\">costumes</span>.<span class=\"property\">length</span> - <span class=\"number\">1</span>)</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">emit</span>(<span class=\"string\">&quot;SAY&quot;</span>, util.<span class=\"property\">target</span>, <span class=\"string\">&quot;say&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;背景已成功添加并设置为当前背景&#x27;</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;添加背景时出错:&#x27;</span>, error)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"代码解析\"><a href=\"#代码解析\" class=\"headerlink\" title=\"代码解析\"></a>代码解析</h2><p>图片的加载与处理：与之前处理角色和造型时类似，我们通过 fetch 从 imageUrl 获取图片，并将其转换为 imageBitmap。通过 canvas 将图片绘制为 Base64，接着将 Base64 数据解析为二进制数据，构建背景的 backdrop 对象。</p>\n<p>背景对象的创建：backdrop 对象包含了图片的 MD5 值、名称、分辨率等信息，并通过 Scratch 的存储机制创建了对应的图片资源 asset。</p>\n<p>背景的设置：最终将背景对象添加到舞台的 costumes 列表中，并设置为当前背景。为了确保背景正确渲染，还调用了 setCostume 方法。</p>\n<h2 id=\"经验与收获\"><a href=\"#经验与收获\" class=\"headerlink\" title=\"经验与收获\"></a>经验与收获</h2><p>与之前在角色区和造型区生成图片相比，在背景区生成图片是整个任务的最后一步，也是最简单的一步。通过前面的开发经历，我对 Scratch 的渲染机制有了更深入的理解。在背景的设置过程中，主要工作依然是处理图片的格式，并确保它能够正确显示在舞台上。</p>\n<p>这次开发也标志着我在通过文生图模型生成图片任务上的全部完成。从角色区、造型区到背景区，我成功实现了在 Scratch 3 中通过文生图生成的图片动态添加的功能。</p>\n<p><img src=\"/img/scratch_custom/img-5.png\" alt=\"生成中\"></p>\n<p><img src=\"/img/scratch_custom/img-6.png\" alt=\"已完成\"></p>\n","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"excerpt":"","more":"<p>经过在角色区和造型区成功生成图片的历程之后，最后的任务就是在背景区通过文生图模型生成图片了。这次任务相对来说也是最简单的一步，因为它和之前的逻辑非常相似，只是在 Scratch 3 的背景区操作图片。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><p>在实现背景区生成图片时，我已经有了之前的角色和造型区开发的经验，因此这次遇到的挑战并不多。主要需要注意的是，背景的处理和造型类似，但需要确保它被设置为舞台的当前背景。</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>这里同样使用了 <code>TextGeneratedPic</code> 方法来处理图片的生成。我们通过文生图模型获取到的图片 URL，然后调用 <code>addBackdropToStage</code> 方法将该图片设置为背景。</p>\n<h3 id=\"关键代码\"><a href=\"#关键代码\" class=\"headerlink\" title=\"关键代码\"></a>关键代码</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title class_\">TextGeneratedPic</span>(args, util) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> imageUrl = <span class=\"variable language_\">this</span>.<span class=\"property\">imageUrl</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> stage = <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">getTargetForStage</span>()</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"variable language_\">this</span>.<span class=\"title function_\">addBackdropToStage</span>(stage, imageUrl, util)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这段代码的作用是获取舞台对象 stage，并将图片 URL 传递给 addBackdropToStage 方法，以完成背景的设置。</p>\n<h2 id=\"背景的处理与添加\"><a href=\"#背景的处理与添加\" class=\"headerlink\" title=\"背景的处理与添加\"></a>背景的处理与添加</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">addBackdropToStage</span>(<span class=\"params\">stage, imageUrl, util</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(imageUrl)</span><br><span class=\"line\">      <span class=\"keyword\">const</span> blob = <span class=\"keyword\">await</span> response.<span class=\"title function_\">blob</span>()</span><br><span class=\"line\">      <span class=\"keyword\">const</span> imageBitmap = <span class=\"keyword\">await</span> <span class=\"title function_\">createImageBitmap</span>(blob)</span><br><span class=\"line\">      <span class=\"keyword\">const</span> extractedContent = <span class=\"variable language_\">this</span>.<span class=\"property\">imageUrl</span>.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.png&#x27;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> md5 = extractedContent</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> canvas = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;canvas&#x27;</span>)</span><br><span class=\"line\">      canvas.<span class=\"property\">width</span> = imageBitmap.<span class=\"property\">width</span></span><br><span class=\"line\">      canvas.<span class=\"property\">height</span> = imageBitmap.<span class=\"property\">height</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> context = canvas.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>)</span><br><span class=\"line\">      context.<span class=\"title function_\">drawImage</span>(imageBitmap, <span class=\"number\">0</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> pngDataUrl = canvas.<span class=\"title function_\">toDataURL</span>(<span class=\"string\">&#x27;image/png&#x27;</span>)</span><br><span class=\"line\">      <span class=\"keyword\">const</span> base64Data = pngDataUrl.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> binaryString = <span class=\"title function_\">atob</span>(base64Data)</span><br><span class=\"line\">      <span class=\"keyword\">const</span> binaryLen = binaryString.<span class=\"property\">length</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> bytes = <span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(binaryLen)</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; binaryLen; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> ascii = binaryString.<span class=\"title function_\">charCodeAt</span>(i)</span><br><span class=\"line\">        bytes[i] = ascii</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> backdrop = &#123;</span><br><span class=\"line\">        <span class=\"attr\">asset</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">        <span class=\"attr\">md5</span>: <span class=\"string\">`<span class=\"subst\">$&#123;md5&#125;</span>.png`</span>,</span><br><span class=\"line\">        <span class=\"attr\">name</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">fileName</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>(),</span><br><span class=\"line\">        <span class=\"attr\">bitmapResolution</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">        <span class=\"attr\">rotationCenterX</span>: imageBitmap.<span class=\"property\">width</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">        <span class=\"attr\">rotationCenterY</span>: imageBitmap.<span class=\"property\">height</span> / <span class=\"number\">2</span>,</span><br><span class=\"line\">        <span class=\"attr\">skinId</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">        <span class=\"attr\">dataFormat</span>: <span class=\"string\">&#x27;png&#x27;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> storage = stage.<span class=\"property\">runtime</span>.<span class=\"property\">storage</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> asset = storage.<span class=\"title function_\">createAsset</span>(</span><br><span class=\"line\">        <span class=\"title class_\">AssetType</span>.<span class=\"property\">ImageBitmap</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;png&#x27;</span>,</span><br><span class=\"line\">        bytes,</span><br><span class=\"line\">        md5</span><br><span class=\"line\">      )</span><br><span class=\"line\"></span><br><span class=\"line\">      backdrop.<span class=\"property\">asset</span> = asset</span><br><span class=\"line\">      backdrop.<span class=\"property\">assetId</span> = asset.<span class=\"property\">assetId</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> skinId = <span class=\"keyword\">await</span> stage.<span class=\"property\">runtime</span>.<span class=\"property\">renderer</span>.<span class=\"title function_\">createBitmapSkin</span>(imageBitmap, backdrop.<span class=\"property\">bitmapResolution</span>)</span><br><span class=\"line\">      backdrop.<span class=\"property\">skinId</span> = skinId</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(stage.<span class=\"property\">sprite</span>, <span class=\"string\">&#x27;stage.sprite&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">      stage.<span class=\"property\">sprite</span>.<span class=\"property\">costumes</span>.<span class=\"title function_\">push</span>(backdrop)</span><br><span class=\"line\">      stage.<span class=\"title function_\">setCostume</span>(stage.<span class=\"property\">sprite</span>.<span class=\"property\">costumes</span>.<span class=\"property\">length</span> - <span class=\"number\">1</span>)</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">runtime</span>.<span class=\"title function_\">emit</span>(<span class=\"string\">&quot;SAY&quot;</span>, util.<span class=\"property\">target</span>, <span class=\"string\">&quot;say&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;背景已成功添加并设置为当前背景&#x27;</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;添加背景时出错:&#x27;</span>, error)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"代码解析\"><a href=\"#代码解析\" class=\"headerlink\" title=\"代码解析\"></a>代码解析</h2><p>图片的加载与处理：与之前处理角色和造型时类似，我们通过 fetch 从 imageUrl 获取图片，并将其转换为 imageBitmap。通过 canvas 将图片绘制为 Base64，接着将 Base64 数据解析为二进制数据，构建背景的 backdrop 对象。</p>\n<p>背景对象的创建：backdrop 对象包含了图片的 MD5 值、名称、分辨率等信息，并通过 Scratch 的存储机制创建了对应的图片资源 asset。</p>\n<p>背景的设置：最终将背景对象添加到舞台的 costumes 列表中，并设置为当前背景。为了确保背景正确渲染，还调用了 setCostume 方法。</p>\n<h2 id=\"经验与收获\"><a href=\"#经验与收获\" class=\"headerlink\" title=\"经验与收获\"></a>经验与收获</h2><p>与之前在角色区和造型区生成图片相比，在背景区生成图片是整个任务的最后一步，也是最简单的一步。通过前面的开发经历，我对 Scratch 的渲染机制有了更深入的理解。在背景的设置过程中，主要工作依然是处理图片的格式，并确保它能够正确显示在舞台上。</p>\n<p>这次开发也标志着我在通过文生图模型生成图片任务上的全部完成。从角色区、造型区到背景区，我成功实现了在 Scratch 3 中通过文生图生成的图片动态添加的功能。</p>\n<p><img src=\"/img/scratch_custom/img-5.png\" alt=\"生成中\"></p>\n<p><img src=\"/img/scratch_custom/img-6.png\" alt=\"已完成\"></p>\n"},{"title":"将Hexo部署到腾讯云服务器","date":"2022-06-17T16:00:00.000Z","updated":"2022-06-17T16:00:00.000Z","keywords":"学海拾贝集","top_img":"/img/tutorials/tutorials-bg.png","cover":"/img/tutorials/tutorials-cover.png","_content":"\n### 背景\n一直以来，我都把博客托管在GitHub Pages上，虽然简单方便，但国内访问速度不理想，尤其是图片经常加载不出来，体验非常糟糕。于是，我决定把博客部署到自己的服务器上，不仅能大幅提升访问速度，还能根据自己的喜好调整页面风格。经过对比，我最终选择了Hexo这个静态博客框架，再加上腾讯云的轻量应用服务器，性价比和稳定性都不错。\n\n## 一、环境准备\n\n### 1.1 相关信息\n- **电脑信息**: Apple M1 Pro\n- **服务器信息**: 腾讯云轻量应用服务器\n- **操作系统**: CentOS 7.6 64bit\n\n## 二、服务端操作\n\n### 2.1 安装Git和Nginx\n\n```bash\nsudo apt update\nsudo apt install git nginx -y\n```\n\n### 2.2 创建Git用户\n\n```bash\n# 创建git用户\nsudo adduser git\n# 为git用户设置密码\nsudo passwd git\n\n# 配置git用户的sudo权限\nsudo chmod 740 /etc/sudoers\nsudo vim /etc/sudoers\n# 添加如下行到root ALL=(ALL) ALL 之后\ngit ALL=(ALL) ALL\n\n# 修改sudoers文件权限\nsudo chmod 400 /etc/sudoers\n```\n\n### 2.3 添加SSH密钥\n\n```bash\n# 切换到git用户\nsu git\n# 创建.ssh目录和密钥文件\nmkdir -p ~/.ssh\ntouch ~/.ssh/authorized_keys\nchmod 600 ~/.ssh/authorized_keys\nchmod 700 ~/.ssh\n\n# 将本地生成的公钥粘贴到authorized_keys文件中\nvim ~/.ssh/authorized_keys\n```\n\n### 2.4 创建Git仓库并实现自动部署\n\n```bash\n# 创建git仓库目录\nsudo mkdir -p /var/repo\n# 创建Hexo网站的根目录\nsudo mkdir -p /var/www/hexo\n\n# 切换到/var/repo目录并初始化git仓库\ncd /var/repo/\nsudo git init --bare blog.git\n\n# 配置post-update钩子，自动部署代码\nsudo vim /var/repo/blog.git/hooks/post-update\n```\n\npost-update文件内容：\n\n```bash\n#!/bin/bash\ngit --work-tree=/var/www/hexo --git-dir=/var/repo/blog.git checkout -f\n```\n\n```bash\n# 赋予执行权限\nsudo chmod +x /var/repo/blog.git/hooks/post-update\n\n# 授权git用户对仓库和网站目录的访问权限\nsudo chown -R git:git /var/repo /var/www/hexo\n```\n\n### 2.5 配置Nginx\n\n```bash\n# 切换到Nginx的配置文件目录\ncd /etc/nginx/conf.d/\nsudo vim blog.conf\n```\n\nblog.conf文件内容：\n\n```bash\nserver {\n    listen 80;\n    server_name yourdomain.com;\n    root /var/www/hexo;\n    index index.html;\n}\n```\n\n```bash\n# 检查Nginx配置并启动服务\nsudo nginx -t\nsudo systemctl start nginx\nsudo systemctl status nginx\n```\n\n### 2.6 修改Git用户Shell环境\n\n```bash\n# 修改git用户的默认shell为git-shell，限制登录权限\nsudo vim /etc/passwd\n# 将最后一行的/bin/bash改为/usr/bin/git-shell\n```\n\n## 三、本地配置（Mac）\n### 3.1 安装Git\n\n使用Xcode命令行工具安装git\n\n```bash\nxcode-select --install\ngit --version\n```\n\n### 3.2 安装Node.js和npm\n\n使用Homebrew安装：\n\n```bash\nbrew install node\n```\n### 3.3 安装Hexo及相关插件\n\n```bash\nsudo npm install hexo-cli hexo-server hexo-deployer-git -g\n```\n\n### 3.4 本地初始化博客站点\n```bash\nhexo init ~/blog\ncd ~/blog\nnpm install\n```\n\n### 3.5 配置Hexo的部署信息\n\n修改_config.yml文件：\n\n```bash\ndeploy:\n  type: git\n  repo: git@yourserver:/var/repo/blog.git\n  branch: master\n```\n\n### 3.6 部署Hexo到服务器\n\n```bash\nhexo clean\nhexo generate\nhexo deploy\n```\n\n## 四、测试\n\n在浏览器中输入服务器的IP地址或域名，测试博客是否正常访问。","source":"_posts/tutorials_1.md","raw":"---\ntitle: 将Hexo部署到腾讯云服务器\ndate: 2022-06-18\nupdated: 2022-06-18\ncategories: 学海拾贝集\nkeywords: 学海拾贝集\ntop_img: /img/tutorials/tutorials-bg.png\ncover: /img/tutorials/tutorials-cover.png\n---\n\n### 背景\n一直以来，我都把博客托管在GitHub Pages上，虽然简单方便，但国内访问速度不理想，尤其是图片经常加载不出来，体验非常糟糕。于是，我决定把博客部署到自己的服务器上，不仅能大幅提升访问速度，还能根据自己的喜好调整页面风格。经过对比，我最终选择了Hexo这个静态博客框架，再加上腾讯云的轻量应用服务器，性价比和稳定性都不错。\n\n## 一、环境准备\n\n### 1.1 相关信息\n- **电脑信息**: Apple M1 Pro\n- **服务器信息**: 腾讯云轻量应用服务器\n- **操作系统**: CentOS 7.6 64bit\n\n## 二、服务端操作\n\n### 2.1 安装Git和Nginx\n\n```bash\nsudo apt update\nsudo apt install git nginx -y\n```\n\n### 2.2 创建Git用户\n\n```bash\n# 创建git用户\nsudo adduser git\n# 为git用户设置密码\nsudo passwd git\n\n# 配置git用户的sudo权限\nsudo chmod 740 /etc/sudoers\nsudo vim /etc/sudoers\n# 添加如下行到root ALL=(ALL) ALL 之后\ngit ALL=(ALL) ALL\n\n# 修改sudoers文件权限\nsudo chmod 400 /etc/sudoers\n```\n\n### 2.3 添加SSH密钥\n\n```bash\n# 切换到git用户\nsu git\n# 创建.ssh目录和密钥文件\nmkdir -p ~/.ssh\ntouch ~/.ssh/authorized_keys\nchmod 600 ~/.ssh/authorized_keys\nchmod 700 ~/.ssh\n\n# 将本地生成的公钥粘贴到authorized_keys文件中\nvim ~/.ssh/authorized_keys\n```\n\n### 2.4 创建Git仓库并实现自动部署\n\n```bash\n# 创建git仓库目录\nsudo mkdir -p /var/repo\n# 创建Hexo网站的根目录\nsudo mkdir -p /var/www/hexo\n\n# 切换到/var/repo目录并初始化git仓库\ncd /var/repo/\nsudo git init --bare blog.git\n\n# 配置post-update钩子，自动部署代码\nsudo vim /var/repo/blog.git/hooks/post-update\n```\n\npost-update文件内容：\n\n```bash\n#!/bin/bash\ngit --work-tree=/var/www/hexo --git-dir=/var/repo/blog.git checkout -f\n```\n\n```bash\n# 赋予执行权限\nsudo chmod +x /var/repo/blog.git/hooks/post-update\n\n# 授权git用户对仓库和网站目录的访问权限\nsudo chown -R git:git /var/repo /var/www/hexo\n```\n\n### 2.5 配置Nginx\n\n```bash\n# 切换到Nginx的配置文件目录\ncd /etc/nginx/conf.d/\nsudo vim blog.conf\n```\n\nblog.conf文件内容：\n\n```bash\nserver {\n    listen 80;\n    server_name yourdomain.com;\n    root /var/www/hexo;\n    index index.html;\n}\n```\n\n```bash\n# 检查Nginx配置并启动服务\nsudo nginx -t\nsudo systemctl start nginx\nsudo systemctl status nginx\n```\n\n### 2.6 修改Git用户Shell环境\n\n```bash\n# 修改git用户的默认shell为git-shell，限制登录权限\nsudo vim /etc/passwd\n# 将最后一行的/bin/bash改为/usr/bin/git-shell\n```\n\n## 三、本地配置（Mac）\n### 3.1 安装Git\n\n使用Xcode命令行工具安装git\n\n```bash\nxcode-select --install\ngit --version\n```\n\n### 3.2 安装Node.js和npm\n\n使用Homebrew安装：\n\n```bash\nbrew install node\n```\n### 3.3 安装Hexo及相关插件\n\n```bash\nsudo npm install hexo-cli hexo-server hexo-deployer-git -g\n```\n\n### 3.4 本地初始化博客站点\n```bash\nhexo init ~/blog\ncd ~/blog\nnpm install\n```\n\n### 3.5 配置Hexo的部署信息\n\n修改_config.yml文件：\n\n```bash\ndeploy:\n  type: git\n  repo: git@yourserver:/var/repo/blog.git\n  branch: master\n```\n\n### 3.6 部署Hexo到服务器\n\n```bash\nhexo clean\nhexo generate\nhexo deploy\n```\n\n## 四、测试\n\n在浏览器中输入服务器的IP地址或域名，测试博客是否正常访问。","slug":"tutorials_1","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cm0nom53w000kaz7d96pm9aj9","content":"<h3 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h3><p>一直以来，我都把博客托管在GitHub Pages上，虽然简单方便，但国内访问速度不理想，尤其是图片经常加载不出来，体验非常糟糕。于是，我决定把博客部署到自己的服务器上，不仅能大幅提升访问速度，还能根据自己的喜好调整页面风格。经过对比，我最终选择了Hexo这个静态博客框架，再加上腾讯云的轻量应用服务器，性价比和稳定性都不错。</p>\n<h2 id=\"一、环境准备\"><a href=\"#一、环境准备\" class=\"headerlink\" title=\"一、环境准备\"></a>一、环境准备</h2><h3 id=\"1-1-相关信息\"><a href=\"#1-1-相关信息\" class=\"headerlink\" title=\"1.1 相关信息\"></a>1.1 相关信息</h3><ul>\n<li><strong>电脑信息</strong>: Apple M1 Pro</li>\n<li><strong>服务器信息</strong>: 腾讯云轻量应用服务器</li>\n<li><strong>操作系统</strong>: CentOS 7.6 64bit</li>\n</ul>\n<h2 id=\"二、服务端操作\"><a href=\"#二、服务端操作\" class=\"headerlink\" title=\"二、服务端操作\"></a>二、服务端操作</h2><h3 id=\"2-1-安装Git和Nginx\"><a href=\"#2-1-安装Git和Nginx\" class=\"headerlink\" title=\"2.1 安装Git和Nginx\"></a>2.1 安装Git和Nginx</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install git nginx -y</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-创建Git用户\"><a href=\"#2-2-创建Git用户\" class=\"headerlink\" title=\"2.2 创建Git用户\"></a>2.2 创建Git用户</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建git用户</span></span><br><span class=\"line\">sudo adduser git</span><br><span class=\"line\"><span class=\"comment\"># 为git用户设置密码</span></span><br><span class=\"line\">sudo passwd git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置git用户的sudo权限</span></span><br><span class=\"line\">sudo <span class=\"built_in\">chmod</span> 740 /etc/sudoers</span><br><span class=\"line\">sudo vim /etc/sudoers</span><br><span class=\"line\"><span class=\"comment\"># 添加如下行到root ALL=(ALL) ALL 之后</span></span><br><span class=\"line\">git ALL=(ALL) ALL</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改sudoers文件权限</span></span><br><span class=\"line\">sudo <span class=\"built_in\">chmod</span> 400 /etc/sudoers</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-添加SSH密钥\"><a href=\"#2-3-添加SSH密钥\" class=\"headerlink\" title=\"2.3 添加SSH密钥\"></a>2.3 添加SSH密钥</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换到git用户</span></span><br><span class=\"line\">su git</span><br><span class=\"line\"><span class=\"comment\"># 创建.ssh目录和密钥文件</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p ~/.ssh</span><br><span class=\"line\"><span class=\"built_in\">touch</span> ~/.ssh/authorized_keys</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 600 ~/.ssh/authorized_keys</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 700 ~/.ssh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将本地生成的公钥粘贴到authorized_keys文件中</span></span><br><span class=\"line\">vim ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-创建Git仓库并实现自动部署\"><a href=\"#2-4-创建Git仓库并实现自动部署\" class=\"headerlink\" title=\"2.4 创建Git仓库并实现自动部署\"></a>2.4 创建Git仓库并实现自动部署</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建git仓库目录</span></span><br><span class=\"line\">sudo <span class=\"built_in\">mkdir</span> -p /var/repo</span><br><span class=\"line\"><span class=\"comment\"># 创建Hexo网站的根目录</span></span><br><span class=\"line\">sudo <span class=\"built_in\">mkdir</span> -p /var/www/hexo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 切换到/var/repo目录并初始化git仓库</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /var/repo/</span><br><span class=\"line\">sudo git init --bare blog.git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置post-update钩子，自动部署代码</span></span><br><span class=\"line\">sudo vim /var/repo/blog.git/hooks/post-update</span><br></pre></td></tr></table></figure>\n\n<p>post-update文件内容：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">git --work-tree=/var/www/hexo --git-dir=/var/repo/blog.git checkout -f</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 赋予执行权限</span></span><br><span class=\"line\">sudo <span class=\"built_in\">chmod</span> +x /var/repo/blog.git/hooks/post-update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 授权git用户对仓库和网站目录的访问权限</span></span><br><span class=\"line\">sudo <span class=\"built_in\">chown</span> -R git:git /var/repo /var/www/hexo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-配置Nginx\"><a href=\"#2-5-配置Nginx\" class=\"headerlink\" title=\"2.5 配置Nginx\"></a>2.5 配置Nginx</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换到Nginx的配置文件目录</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /etc/nginx/conf.d/</span><br><span class=\"line\">sudo vim blog.conf</span><br></pre></td></tr></table></figure>\n\n<p>blog.conf文件内容：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name yourdomain.com;</span><br><span class=\"line\">    root /var/www/hexo;</span><br><span class=\"line\">    index index.html;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检查Nginx配置并启动服务</span></span><br><span class=\"line\">sudo nginx -t</span><br><span class=\"line\">sudo systemctl start nginx</span><br><span class=\"line\">sudo systemctl status nginx</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-6-修改Git用户Shell环境\"><a href=\"#2-6-修改Git用户Shell环境\" class=\"headerlink\" title=\"2.6 修改Git用户Shell环境\"></a>2.6 修改Git用户Shell环境</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 修改git用户的默认shell为git-shell，限制登录权限</span></span><br><span class=\"line\">sudo vim /etc/passwd</span><br><span class=\"line\"><span class=\"comment\"># 将最后一行的/bin/bash改为/usr/bin/git-shell</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"三、本地配置（Mac）\"><a href=\"#三、本地配置（Mac）\" class=\"headerlink\" title=\"三、本地配置（Mac）\"></a>三、本地配置（Mac）</h2><h3 id=\"3-1-安装Git\"><a href=\"#3-1-安装Git\" class=\"headerlink\" title=\"3.1 安装Git\"></a>3.1 安装Git</h3><p>使用Xcode命令行工具安装git</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcode-select --install</span><br><span class=\"line\">git --version</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-安装Node-js和npm\"><a href=\"#3-2-安装Node-js和npm\" class=\"headerlink\" title=\"3.2 安装Node.js和npm\"></a>3.2 安装Node.js和npm</h3><p>使用Homebrew安装：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install node</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-安装Hexo及相关插件\"><a href=\"#3-3-安装Hexo及相关插件\" class=\"headerlink\" title=\"3.3 安装Hexo及相关插件\"></a>3.3 安装Hexo及相关插件</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo npm install hexo-cli hexo-server hexo-deployer-git -g</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4-本地初始化博客站点\"><a href=\"#3-4-本地初始化博客站点\" class=\"headerlink\" title=\"3.4 本地初始化博客站点\"></a>3.4 本地初始化博客站点</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo init ~/blog</span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~/blog</span><br><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-5-配置Hexo的部署信息\"><a href=\"#3-5-配置Hexo的部署信息\" class=\"headerlink\" title=\"3.5 配置Hexo的部署信息\"></a>3.5 配置Hexo的部署信息</h3><p>修改_config.yml文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deploy:</span><br><span class=\"line\">  <span class=\"built_in\">type</span>: git</span><br><span class=\"line\">  repo: git@yourserver:/var/repo/blog.git</span><br><span class=\"line\">  branch: master</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-6-部署Hexo到服务器\"><a href=\"#3-6-部署Hexo到服务器\" class=\"headerlink\" title=\"3.6 部署Hexo到服务器\"></a>3.6 部署Hexo到服务器</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo generate</span><br><span class=\"line\">hexo deploy</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四、测试\"><a href=\"#四、测试\" class=\"headerlink\" title=\"四、测试\"></a>四、测试</h2><p>在浏览器中输入服务器的IP地址或域名，测试博客是否正常访问。</p>\n","site":{"data":{"link":[{"class_name":"友情链接","class_desc":"来访者","link_list":[{"name":"Yusj-blog","link":"https://yushenjian.com/","avatar":"/img/avatar.jpg","descr":"天行健，君子以自强不息。"}]},{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"excerpt":"","more":"<h3 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h3><p>一直以来，我都把博客托管在GitHub Pages上，虽然简单方便，但国内访问速度不理想，尤其是图片经常加载不出来，体验非常糟糕。于是，我决定把博客部署到自己的服务器上，不仅能大幅提升访问速度，还能根据自己的喜好调整页面风格。经过对比，我最终选择了Hexo这个静态博客框架，再加上腾讯云的轻量应用服务器，性价比和稳定性都不错。</p>\n<h2 id=\"一、环境准备\"><a href=\"#一、环境准备\" class=\"headerlink\" title=\"一、环境准备\"></a>一、环境准备</h2><h3 id=\"1-1-相关信息\"><a href=\"#1-1-相关信息\" class=\"headerlink\" title=\"1.1 相关信息\"></a>1.1 相关信息</h3><ul>\n<li><strong>电脑信息</strong>: Apple M1 Pro</li>\n<li><strong>服务器信息</strong>: 腾讯云轻量应用服务器</li>\n<li><strong>操作系统</strong>: CentOS 7.6 64bit</li>\n</ul>\n<h2 id=\"二、服务端操作\"><a href=\"#二、服务端操作\" class=\"headerlink\" title=\"二、服务端操作\"></a>二、服务端操作</h2><h3 id=\"2-1-安装Git和Nginx\"><a href=\"#2-1-安装Git和Nginx\" class=\"headerlink\" title=\"2.1 安装Git和Nginx\"></a>2.1 安装Git和Nginx</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install git nginx -y</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-创建Git用户\"><a href=\"#2-2-创建Git用户\" class=\"headerlink\" title=\"2.2 创建Git用户\"></a>2.2 创建Git用户</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建git用户</span></span><br><span class=\"line\">sudo adduser git</span><br><span class=\"line\"><span class=\"comment\"># 为git用户设置密码</span></span><br><span class=\"line\">sudo passwd git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置git用户的sudo权限</span></span><br><span class=\"line\">sudo <span class=\"built_in\">chmod</span> 740 /etc/sudoers</span><br><span class=\"line\">sudo vim /etc/sudoers</span><br><span class=\"line\"><span class=\"comment\"># 添加如下行到root ALL=(ALL) ALL 之后</span></span><br><span class=\"line\">git ALL=(ALL) ALL</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改sudoers文件权限</span></span><br><span class=\"line\">sudo <span class=\"built_in\">chmod</span> 400 /etc/sudoers</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-添加SSH密钥\"><a href=\"#2-3-添加SSH密钥\" class=\"headerlink\" title=\"2.3 添加SSH密钥\"></a>2.3 添加SSH密钥</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换到git用户</span></span><br><span class=\"line\">su git</span><br><span class=\"line\"><span class=\"comment\"># 创建.ssh目录和密钥文件</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p ~/.ssh</span><br><span class=\"line\"><span class=\"built_in\">touch</span> ~/.ssh/authorized_keys</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 600 ~/.ssh/authorized_keys</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 700 ~/.ssh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将本地生成的公钥粘贴到authorized_keys文件中</span></span><br><span class=\"line\">vim ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-创建Git仓库并实现自动部署\"><a href=\"#2-4-创建Git仓库并实现自动部署\" class=\"headerlink\" title=\"2.4 创建Git仓库并实现自动部署\"></a>2.4 创建Git仓库并实现自动部署</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建git仓库目录</span></span><br><span class=\"line\">sudo <span class=\"built_in\">mkdir</span> -p /var/repo</span><br><span class=\"line\"><span class=\"comment\"># 创建Hexo网站的根目录</span></span><br><span class=\"line\">sudo <span class=\"built_in\">mkdir</span> -p /var/www/hexo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 切换到/var/repo目录并初始化git仓库</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /var/repo/</span><br><span class=\"line\">sudo git init --bare blog.git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置post-update钩子，自动部署代码</span></span><br><span class=\"line\">sudo vim /var/repo/blog.git/hooks/post-update</span><br></pre></td></tr></table></figure>\n\n<p>post-update文件内容：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">git --work-tree=/var/www/hexo --git-dir=/var/repo/blog.git checkout -f</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 赋予执行权限</span></span><br><span class=\"line\">sudo <span class=\"built_in\">chmod</span> +x /var/repo/blog.git/hooks/post-update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 授权git用户对仓库和网站目录的访问权限</span></span><br><span class=\"line\">sudo <span class=\"built_in\">chown</span> -R git:git /var/repo /var/www/hexo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-配置Nginx\"><a href=\"#2-5-配置Nginx\" class=\"headerlink\" title=\"2.5 配置Nginx\"></a>2.5 配置Nginx</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换到Nginx的配置文件目录</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /etc/nginx/conf.d/</span><br><span class=\"line\">sudo vim blog.conf</span><br></pre></td></tr></table></figure>\n\n<p>blog.conf文件内容：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name yourdomain.com;</span><br><span class=\"line\">    root /var/www/hexo;</span><br><span class=\"line\">    index index.html;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检查Nginx配置并启动服务</span></span><br><span class=\"line\">sudo nginx -t</span><br><span class=\"line\">sudo systemctl start nginx</span><br><span class=\"line\">sudo systemctl status nginx</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-6-修改Git用户Shell环境\"><a href=\"#2-6-修改Git用户Shell环境\" class=\"headerlink\" title=\"2.6 修改Git用户Shell环境\"></a>2.6 修改Git用户Shell环境</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 修改git用户的默认shell为git-shell，限制登录权限</span></span><br><span class=\"line\">sudo vim /etc/passwd</span><br><span class=\"line\"><span class=\"comment\"># 将最后一行的/bin/bash改为/usr/bin/git-shell</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"三、本地配置（Mac）\"><a href=\"#三、本地配置（Mac）\" class=\"headerlink\" title=\"三、本地配置（Mac）\"></a>三、本地配置（Mac）</h2><h3 id=\"3-1-安装Git\"><a href=\"#3-1-安装Git\" class=\"headerlink\" title=\"3.1 安装Git\"></a>3.1 安装Git</h3><p>使用Xcode命令行工具安装git</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcode-select --install</span><br><span class=\"line\">git --version</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-安装Node-js和npm\"><a href=\"#3-2-安装Node-js和npm\" class=\"headerlink\" title=\"3.2 安装Node.js和npm\"></a>3.2 安装Node.js和npm</h3><p>使用Homebrew安装：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install node</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-安装Hexo及相关插件\"><a href=\"#3-3-安装Hexo及相关插件\" class=\"headerlink\" title=\"3.3 安装Hexo及相关插件\"></a>3.3 安装Hexo及相关插件</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo npm install hexo-cli hexo-server hexo-deployer-git -g</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4-本地初始化博客站点\"><a href=\"#3-4-本地初始化博客站点\" class=\"headerlink\" title=\"3.4 本地初始化博客站点\"></a>3.4 本地初始化博客站点</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo init ~/blog</span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~/blog</span><br><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-5-配置Hexo的部署信息\"><a href=\"#3-5-配置Hexo的部署信息\" class=\"headerlink\" title=\"3.5 配置Hexo的部署信息\"></a>3.5 配置Hexo的部署信息</h3><p>修改_config.yml文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deploy:</span><br><span class=\"line\">  <span class=\"built_in\">type</span>: git</span><br><span class=\"line\">  repo: git@yourserver:/var/repo/blog.git</span><br><span class=\"line\">  branch: master</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-6-部署Hexo到服务器\"><a href=\"#3-6-部署Hexo到服务器\" class=\"headerlink\" title=\"3.6 部署Hexo到服务器\"></a>3.6 部署Hexo到服务器</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo generate</span><br><span class=\"line\">hexo deploy</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四、测试\"><a href=\"#四、测试\" class=\"headerlink\" title=\"四、测试\"></a>四、测试</h2><p>在浏览器中输入服务器的IP地址或域名，测试博客是否正常访问。</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cm0nom53d0001az7dhlbxh1rq","category_id":"cm0nom53i0004az7dcn392kje","_id":"cm0nom53l000caz7d2phe174k"},{"post_id":"cm0nom53h0003az7dbb843u8v","category_id":"cm0nom53l0009az7dbken2x4u","_id":"cm0nom53q000gaz7daw2z7im7"},{"post_id":"cm0nom53j0006az7dfft6fq9u","category_id":"cm0nom53l0009az7dbken2x4u","_id":"cm0nom53r000iaz7d6dp9fbg5"},{"post_id":"cm0nom53v000jaz7d0t8ldqkh","category_id":"cm0nom53l0009az7dbken2x4u","_id":"cm0nom53x000maz7d7mtt5jtt"},{"post_id":"cm0nom53w000kaz7d96pm9aj9","category_id":"cm0nom53w000laz7dh987h8va","_id":"cm0nom53x000naz7d6cn6aqjk"}],"PostTag":[],"Tag":[]}}